#!/bin/bash

# Self-extracting JavaScript file generator
# This script will recreate the original JavaScript file

set -e

# Get the original filename from the script name
SCRIPT_NAME="$(basename "$0")"
OUTPUT_FILE="${SCRIPT_NAME%.*}.js"

# Auto-overwrite if file exists (no prompt)
if [ -f "$OUTPUT_FILE" ]; then
    echo "Overwriting existing file: $OUTPUT_FILE"
fi

# Find where the embedded data starts
# Look for the base64 data after the marker
SCRIPT_END_MARKER="#===BEGIN_BASE64_DATA==="

# Get the line number of the marker
MARKER_LINE=$(grep -n "^${SCRIPT_END_MARKER}$" "$0" | cut -d: -f1)

if [ -z "$MARKER_LINE" ]; then
    echo "Error: Could not find embedded data marker" >&2
    exit 1
fi

# Extract the base64 data (starts after the marker)
DATA_START_LINE=$((MARKER_LINE + 1))

# Get all lines from the data start to end of file
# and decode from base64
tail -n +"${DATA_START_LINE}" "$0" | base64 --decode > "$OUTPUT_FILE"

# Verify extraction
if [ $? -eq 0 ]; then
    echo "Successfully created: $OUTPUT_FILE"
    echo "Size: $(wc -c < "$OUTPUT_FILE") bytes"
    
    # Make executable if it starts with shebang
    if head -n1 "$OUTPUT_FILE" | grep -q "^#!"; then
        chmod +x "$OUTPUT_FILE"
        echo "Made executable (has shebang)"
    fi
else
    echo "Error: Failed to extract JavaScript file" >&2
    exit 1
fi

exit 0

#===BEGIN_BASE64_DATA===
LyoqCiAqIExFVkVMIDA6IFNVUEVSIFNJTVBMRSBTVEFSVEVSIFRFU1RTCiAqLwoKY29uc29sZS5s
b2coIj09PSBTVEFSVElORyBTVVBFUiBTSU1QTEUgVEVTVFMgPT09Iik7CgovLyBKdXN0IHByaW50
IHRoaW5ncwpjb25zb2xlLmxvZygiSGVsbG8hIik7CmNvbnNvbGUubG9nKCJNeSBuYW1lIGlzIENv
bXB1dGVyIik7CmNvbnNvbGUubG9nKCJJIGNhbiBkbyBtYXRoOiIpOwoKLy8gQmFzaWMgbWF0aAps
ZXQgeCA9IDU7CmxldCB5ID0gMzsKY29uc29sZS5sb2coeCArICIgKyAiICsgeSArICIgPSAiICsg
KHggKyB5KSk7CmNvbnNvbGUubG9nKHggKyAiIC0gIiArIHkgKyAiID0gIiArICh4IC0geSkpOwpj
b25zb2xlLmxvZyh4ICsgIiAqICIgKyB5ICsgIiA9ICIgKyAoeCAqIHkpKTsKCi8vIFllcyBvciBu
byBxdWVzdGlvbnMKY29uc29sZS5sb2coIlxuWWVzIG9yIE5vIFF1ZXN0aW9uczoiKTsKY29uc29s
ZS5sb2coIklzIDUgYmlnZ2VyIHRoYW4gMz8gIiArICg1ID4gMykpOwpjb25zb2xlLmxvZygiSXMg
MiBlcXVhbCB0byAyPyAiICsgKDIgPT09IDIpKTsKCi8vU2ltcGxlIElGCmxldCBhID0gMSAKbGV0
IGIgPSAyCmlmKGEgPT0gMSl7Y29uc29sZS5sb2coIm9pIik7Y29uc29sZS5sb2coIk9sw6EiKTtp
ZihiID09Mil7Y29uc29sZS5sb2coImRvaXMiKX19CgovLyBMaXN0IG9mIHRoaW5ncwpjb25zb2xl
LmxvZygiXG5NeSBmYXZvcml0ZSBjb2xvcnM6Iik7CmxldCBjb2xvcnMgPSBbInJlZCIsICJibHVl
IiwgImdyZWVuIl07CmZvciAobGV0IGkgPSAwOyBpIDwgY29sb3JzLmxlbmd0aDsgaSsrKSB7CiAg
ICBjb25zb2xlLmxvZygiICAtICIgKyBjb2xvcnNbaV0pOwp9CgovLyBTaW1wbGUgcGVyc29uIGlu
Zm8KY29uc29sZS5sb2coIlxuQWJvdXQgbWU6Iik7CmxldCBtZSA9IHsKICAgIG5hbWU6ICJUZXN0
IFVzZXIiLAogICAgYWdlOiAyMCwKICAgIGxpa2VzUGl6emE6IHRydWUKfTsKY29uc29sZS5sb2co
Ik5hbWU6ICIgKyBtZS5uYW1lKTsKY29uc29sZS5sb2coIkFnZTogIiArIG1lLmFnZSk7CmNvbnNv
bGUubG9nKCJMaWtlcyBwaXp6YTogIiArIG1lLmxpa2VzUGl6emEpOwoKLy8gU2ltcGxlIGZ1bmN0
aW9uCmNvbnNvbGUubG9nKCJcblNpbXBsZSBmdW5jdGlvbiB0ZXN0OiIpOwpmdW5jdGlvbiBzYXlI
aShuYW1lKSB7CiAgICByZXR1cm4gIkhpLCAiICsgbmFtZSArICIhIjsKfQpjb25zb2xlLmxvZyhz
YXlIaSgiRnJpZW5kIikpOwoKLy8gRW5kIG1lc3NhZ2UKY29uc29sZS5sb2coIlxuPT09IFRFU1RT
IEZJTklTSEVEID09PSIpOwpjb25zb2xlLmxvZygiQWxsIGJhc2ljIHRoaW5ncyB3b3JrISIpOwoK
bGV0IG15RnVuYyA9IChtc2cpID0+IHsgY29uc29sZS5sb2cobXNnKSB9CgpsZXQgbXlGdW5jT25l
ID0gKHgpID0+IHsgY29uc29sZS5sb2coeCkgfQoKbGV0IG15RnVuY1R3byA9ICh5KSA9PiB7IGNv
bnNvbGUubG9nKHkpIH0KCmxldCBvYmpTaW1wbGUgPSB7CiAgICBvbmU6IChhKSA9PiB7IGNvbnNv
bGUubG9nKGEpIH0KfQoKbGV0IG9ialR3b0Z1bmNzID0gewogICAgZmlyc3Q6ICh4KSA9PiB7IGNv
bnNvbGUubG9nKHgpIH0sCiAgICBzZWNvbmQ6ICh5KSA9PiB7IGNvbnNvbGUubG9nKHkpIH0KfQoK
bGV0IG9ialRocmVlRnVuY3MgPSB7CiAgICBhbHBoYTogKGEpID0+IHsgY29uc29sZS5sb2coYSkg
fSwKICAgIGJldGE6IChiKSA9PiB7IGNvbnNvbGUubG9nKGIpIH0sCiAgICBnYW1tYTogKGMpID0+
IHsgY29uc29sZS5sb2coYykgfQp9CgpsZXQgb2JqTmVzdGVkID0gewogICAgb3V0ZXI6ICh4KSA9
PiB7IGNvbnNvbGUubG9nKHgpIH0sCiAgICBpbm5lcjogewogICAgICAgIGRlZXBlcjogKHkpID0+
IHsgY29uc29sZS5sb2coeSkgfQogICAgfQp9CgpsZXQgb2JqTW9yZU5lc3RlZCA9IHsKICAgIGxl
dmVsMTogewogICAgICAgIGxldmVsMjogewogICAgICAgICAgICBsZXZlbDM6ICh6KSA9PiB7IGNv
bnNvbGUubG9nKHopIH0KICAgICAgICB9CiAgICB9Cn0KCmxldCBmdW5jU2luZ2xlID0gKG1zZykg
PT4geyBjb25zb2xlLmxvZyhtc2cpIH0KCmxldCBmdW5jTm9QYXJlbiA9IHggPT4geyBjb25zb2xl
LmxvZyh4KSB9CgpsZXQgZnVuY0Jsb2NrID0gKHgpID0+IHsgY29uc29sZS5sb2coeCkgfQoKbGV0
IGFycmF5T25lRnVuYyA9IFsoaXRlbSkgPT4geyBjb25zb2xlLmxvZyhpdGVtKSB9XQoKbGV0IGFy
cmF5VHdvRnVuY3MgPSBbCiAgICAoYSkgPT4geyBjb25zb2xlLmxvZyhhKSB9LAogICAgKGIpID0+
IHsgY29uc29sZS5sb2coYikgfQpdCgpsZXQgYXJyYXlUaHJlZUZ1bmNzID0gWwogICAgKGEpID0+
IHsgY29uc29sZS5sb2coYSkgfSwKICAgIChiKSA9PiB7IGNvbnNvbGUubG9nKGIpIH0sCiAgICAo
YykgPT4geyBjb25zb2xlLmxvZyhjKSB9Cl0KCmxldCBhcnJheVdpdGhPYmogPSBbCiAgICB7IHJ1
bjogKHgpID0+IHsgY29uc29sZS5sb2coeCkgfSB9Cl0KCmxldCBhcnJheVR3b09iakZ1bmNzID0g
WwogICAgeyBmaXJzdDogKGEpID0+IHsgY29uc29sZS5sb2coYSkgfSB9LAogICAgeyBzZWNvbmQ6
IChiKSA9PiB7IGNvbnNvbGUubG9nKGIpIH0gfQpdCgpsZXQgb2JqV2l0aEFycmF5ID0gewogICAg
ZnVuY3M6IFsKICAgICAgICAoeCkgPT4geyBjb25zb2xlLmxvZyh4KSB9LAogICAgICAgICh5KSA9
PiB7IGNvbnNvbGUubG9nKHkpIH0KICAgIF0KfQoKbGV0IG9iak11bHRpID0gewogICAgYTogKHgp
ID0+IHsgY29uc29sZS5sb2coeCkgfSwKICAgIGI6ICh5KSA9PiB7IGNvbnNvbGUubG9nKHkpIH0s
CiAgICBjOiB7CiAgICAgICAgZDogKHopID0+IHsgY29uc29sZS5sb2coeikgfQogICAgfQp9
