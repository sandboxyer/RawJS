#!/bin/bash

# Self-extracting JavaScript file generator
# This script will recreate the original JavaScript file

set -e

# Get the original filename from the script name
SCRIPT_NAME="$(basename "$0")"
OUTPUT_FILE="${SCRIPT_NAME%.*}.js"

# Auto-overwrite if file exists (no prompt)
if [ -f "$OUTPUT_FILE" ]; then
    echo "Overwriting existing file: $OUTPUT_FILE"
fi

# Find where the embedded data starts
# Look for the base64 data after the marker
SCRIPT_END_MARKER="#===BEGIN_BASE64_DATA==="

# Get the line number of the marker
MARKER_LINE=$(grep -n "^${SCRIPT_END_MARKER}$" "$0" | cut -d: -f1)

if [ -z "$MARKER_LINE" ]; then
    echo "Error: Could not find embedded data marker" >&2
    exit 1
fi

# Extract the base64 data (starts after the marker)
DATA_START_LINE=$((MARKER_LINE + 1))

# Get all lines from the data start to end of file
# and decode from base64
tail -n +"${DATA_START_LINE}" "$0" | base64 --decode > "$OUTPUT_FILE"

# Verify extraction
if [ $? -eq 0 ]; then
    echo "Successfully created: $OUTPUT_FILE"
    echo "Size: $(wc -c < "$OUTPUT_FILE") bytes"
    
    # Make executable if it starts with shebang
    if head -n1 "$OUTPUT_FILE" | grep -q "^#!"; then
        chmod +x "$OUTPUT_FILE"
        echo "Made executable (has shebang)"
    fi
else
    echo "Error: Failed to extract JavaScript file" >&2
    exit 1
fi

exit 0

#===BEGIN_BASE64_DATA===
LyoqCiAqIExFVkVMIDA6IFVMVFJBLUJBU0lDIEpBVkFTQ1JJUFQgVEVTVElORwogKiBKdXN0IHRl
c3RpbmcgYmFzaWMgc3ludGF4LCBjb25zb2xlIGxvZ3MsIGFuZCBzaW1wbGUgbG9naWMKICovCgpj
b25zb2xlLmxvZygi8J+UpyBTVEFSVElORyBMRVZFTCAwIEJBU0lDIFRFU1RTIik7CmNvbnNvbGUu
bG9nKCI9Ii5yZXBlYXQoNDApKTsKCi8vID09PT09PT09PT0gVEVTVCAxOiBCQVNJQyBDT05TT0xF
IE9VVFBVVCA9PT09PT09PT09CmNvbnNvbGUubG9nKCJcbvCfk50gVEVTVCAxOiBDb25zb2xlIE91
dHB1dCIpOwpjb25zb2xlLmxvZygiSGVsbG8gV29ybGQhIik7CmNvbnNvbGUubG9nKCJOdW1iZXJz
OiIsIDEsIDIsIDMpOwpjb25zb2xlLmxvZygiTWl4ZWQ6IiwgIlRleHQiLCB0cnVlLCA0Mik7Cgov
LyA9PT09PT09PT09IFRFU1QgMjogVkFSSUFCTEVTID09PT09PT09PT0KY29uc29sZS5sb2coIlxu
8J+TpiBURVNUIDI6IFZhcmlhYmxlcyIpOwpsZXQgbXlOYW1lID0gIkFsZXgiOwpjb25zdCBteUFn
ZSA9IDI1Owp2YXIgb2xkV2F5ID0gIm9sZCI7CmNvbnNvbGUubG9nKCJOYW1lOiIsIG15TmFtZSk7
CmNvbnNvbGUubG9nKCJBZ2U6IiwgbXlBZ2UpOwpjb25zb2xlLmxvZygiT2xkIHdheToiLCBvbGRX
YXkpOwoKLy8gPT09PT09PT09PSBURVNUIDM6IFNJTVBMRSBNQVRIID09PT09PT09PT0KY29uc29s
ZS5sb2coIlxu4p6VIFRFU1QgMzogU2ltcGxlIE1hdGgiKTsKbGV0IGEgPSAxMDsKbGV0IGIgPSA1
Owpjb25zb2xlLmxvZyhhLCAiKyIsIGIsICI9IiwgYSArIGIpOwpjb25zb2xlLmxvZyhhLCAiLSIs
IGIsICI9IiwgYSAtIGIpOwpjb25zb2xlLmxvZyhhLCAiKiIsIGIsICI9IiwgYSAqIGIpOwpjb25z
b2xlLmxvZyhhLCAiLyIsIGIsICI9IiwgYSAvIGIpOwoKLy8gPT09PT09PT09PSBURVNUIDQ6IFNU
UklOR1MgPT09PT09PT09PQpjb25zb2xlLmxvZygiXG7wn5OEIFRFU1QgNDogU3RyaW5ncyIpOwps
ZXQgZmlyc3ROYW1lID0gIkpvaG4iOwpsZXQgbGFzdE5hbWUgPSAiRG9lIjsKbGV0IGZ1bGxOYW1l
ID0gZmlyc3ROYW1lICsgIiAiICsgbGFzdE5hbWU7CmNvbnNvbGUubG9nKCJGdWxsIG5hbWU6Iiwg
ZnVsbE5hbWUpOwpjb25zb2xlLmxvZygiTmFtZSBsZW5ndGg6IiwgZmlyc3ROYW1lLmxlbmd0aCk7
CgovLyA9PT09PT09PT09IFRFU1QgNTogQk9PTEVBTlMgPT09PT09PT09PQpjb25zb2xlLmxvZygi
XG7inIUgVEVTVCA1OiBCb29sZWFucyIpOwpsZXQgaXNUcnVlID0gdHJ1ZTsKbGV0IGlzRmFsc2Ug
PSBmYWxzZTsKY29uc29sZS5sb2coIlRydWU6IiwgaXNUcnVlKTsKY29uc29sZS5sb2coIkZhbHNl
OiIsIGlzRmFsc2UpOwpjb25zb2xlLmxvZygiTk9UIHRydWU6IiwgIWlzVHJ1ZSk7CmNvbnNvbGUu
bG9nKCJUcnVlIEFORCBGYWxzZToiLCBpc1RydWUgJiYgaXNGYWxzZSk7CmNvbnNvbGUubG9nKCJU
cnVlIE9SIEZhbHNlOiIsIGlzVHJ1ZSB8fCBpc0ZhbHNlKTsKCi8vID09PT09PT09PT0gVEVTVCA2
OiBDT01QQVJJU09OUyA9PT09PT09PT09CmNvbnNvbGUubG9nKCJcbuKalu+4jyBURVNUIDY6IENv
bXBhcmlzb25zIik7CmNvbnNvbGUubG9nKCI1ID4gMzoiLCA1ID4gMyk7CmNvbnNvbGUubG9nKCI1
IDwgMzoiLCA1IDwgMyk7CmNvbnNvbGUubG9nKCI1ID09PSA1OiIsIDUgPT09IDUpOwpjb25zb2xl
LmxvZygiNSA9PT0gJzUnOiIsIDUgPT09ICc1Jyk7CmNvbnNvbGUubG9nKCI1ID09ICc1JzoiLCA1
ID09ICc1Jyk7CmNvbnNvbGUubG9nKCI1ICE9PSAzOiIsIDUgIT09IDMpOwoKLy8gPT09PT09PT09
PSBURVNUIDc6IElGIFNUQVRFTUVOVFMgPT09PT09PT09PQpjb25zb2xlLmxvZygiXG7wn6SUIFRF
U1QgNzogSWYgU3RhdGVtZW50cyIpOwpsZXQgdGVtcGVyYXR1cmUgPSAyMjsKCmlmICh0ZW1wZXJh
dHVyZSA+IDMwKSB7CiAgICBjb25zb2xlLmxvZygiSXQncyBob3QhIik7Cn0gZWxzZSBpZiAodGVt
cGVyYXR1cmUgPiAyMCkgewogICAgY29uc29sZS5sb2coIk5pY2Ugd2VhdGhlciEiKTsKfSBlbHNl
IHsKICAgIGNvbnNvbGUubG9nKCJJdCdzIGNvbGQhIik7Cn0KCi8vIFNpbXBsZSBjb25kaXRpb24K
bGV0IGNhbkRyaXZlID0gYWdlID0+IGFnZSA+PSAxOCA/ICJDYW4gZHJpdmUiIDogIkNhbm5vdCBk
cml2ZSI7CmNvbnNvbGUubG9nKCJBZ2UgMTY6IiwgY2FuRHJpdmUoMTYpKTsKY29uc29sZS5sb2co
IkFnZSAyMToiLCBjYW5Ecml2ZSgyMSkpOwoKLy8gPT09PT09PT09PSBURVNUIDg6IExPT1BTID09
PT09PT09PT0KY29uc29sZS5sb2coIlxu8J+UhCBURVNUIDg6IExvb3BzIik7CgovLyBGb3IgbG9v
cApjb25zb2xlLmxvZygiQ291bnRpbmcgMS0zOiIpOwpmb3IgKGxldCBpID0gMTsgaSA8PSAzOyBp
KyspIHsKICAgIGNvbnNvbGUubG9nKCIgIE51bWJlcjoiLCBpKTsKfQoKLy8gV2hpbGUgbG9vcApj
b25zb2xlLmxvZygiQ291bnRkb3duOiIpOwpsZXQgY291bnQgPSAzOwp3aGlsZSAoY291bnQgPiAw
KSB7CiAgICBjb25zb2xlLmxvZygiICBULW1pbnVzOiIsIGNvdW50KTsKICAgIGNvdW50LS07Cn0K
Ci8vID09PT09PT09PT0gVEVTVCA5OiBBUlJBWVMgPT09PT09PT09PQpjb25zb2xlLmxvZygiXG7w
n5OLIFRFU1QgOTogQXJyYXlzIik7CmxldCBmcnVpdHMgPSBbImFwcGxlIiwgImJhbmFuYSIsICJv
cmFuZ2UiXTsKY29uc29sZS5sb2coIkZydWl0czoiLCBmcnVpdHMpOwpjb25zb2xlLmxvZygiRmly
c3QgZnJ1aXQ6IiwgZnJ1aXRzWzBdKTsKY29uc29sZS5sb2coIkxhc3QgZnJ1aXQ6IiwgZnJ1aXRz
W2ZydWl0cy5sZW5ndGggLSAxXSk7CgovLyBBZGQgYW5kIHJlbW92ZQpmcnVpdHMucHVzaCgiZ3Jh
cGUiKTsKY29uc29sZS5sb2coIkFmdGVyIGFkZGluZyBncmFwZToiLCBmcnVpdHMpOwpmcnVpdHMu
cG9wKCk7CmNvbnNvbGUubG9nKCJBZnRlciByZW1vdmluZyBsYXN0OiIsIGZydWl0cyk7CgovLyA9
PT09PT09PT09IFRFU1QgMTA6IE9CSkVDVFMgPT09PT09PT09PQpjb25zb2xlLmxvZygiXG7wn46v
IFRFU1QgMTA6IE9iamVjdHMiKTsKbGV0IHBlcnNvbiA9IHsKICAgIG5hbWU6ICJTYXJhaCIsCiAg
ICBhZ2U6IDMwLAogICAgY2l0eTogIkxvbmRvbiIsCiAgICBzYXlIZWxsbzogZnVuY3Rpb24oKSB7
CiAgICAgICAgcmV0dXJuICJIZWxsbywgSSdtICIgKyB0aGlzLm5hbWU7CiAgICB9Cn07Cgpjb25z
b2xlLmxvZygiUGVyc29uOiIsIHBlcnNvbik7CmNvbnNvbGUubG9nKCJOYW1lOiIsIHBlcnNvbi5u
YW1lKTsKY29uc29sZS5sb2coIkFnZToiLCBwZXJzb24uYWdlKTsKY29uc29sZS5sb2cocGVyc29u
LnNheUhlbGxvKCkpOwoKLy8gPT09PT09PT09PSBURVNUIDExOiBGVU5DVElPTlMgPT09PT09PT09
PQpjb25zb2xlLmxvZygiXG7impnvuI8gVEVTVCAxMTogRnVuY3Rpb25zIik7CgovLyBTaW1wbGUg
ZnVuY3Rpb24KZnVuY3Rpb24gZ3JlZXQobmFtZSkgewogICAgcmV0dXJuICJIZWxsbywgIiArIG5h
bWUgKyAiISI7Cn0KY29uc29sZS5sb2coZ3JlZXQoIkFsaWNlIikpOwoKLy8gQXJyb3cgZnVuY3Rp
b24KY29uc3QgYWRkID0gKHgsIHkpID0+IHggKyB5Owpjb25zb2xlLmxvZygiNSArIDMgPSIsIGFk
ZCg1LCAzKSk7CgovLyBGdW5jdGlvbiB3aXRoIGRlZmF1bHQKY29uc3Qgd2VsY29tZSA9IChuYW1l
ID0gIkd1ZXN0IikgPT4gIldlbGNvbWUsICIgKyBuYW1lOwpjb25zb2xlLmxvZyh3ZWxjb21lKCkp
Owpjb25zb2xlLmxvZyh3ZWxjb21lKCJCb2IiKSk7CgovLyA9PT09PT09PT09IFRFU1QgMTI6IFRZ
UEUgQ0hFQ0tTID09PT09PT09PT0KY29uc29sZS5sb2coIlxu8J+UjSBURVNUIDEyOiBUeXBlIENo
ZWNrcyIpOwpjb25zb2xlLmxvZygidHlwZW9mICdoZWxsbyc6IiwgdHlwZW9mICJoZWxsbyIpOwpj
b25zb2xlLmxvZygidHlwZW9mIDQyOiIsIHR5cGVvZiA0Mik7CmNvbnNvbGUubG9nKCJ0eXBlb2Yg
dHJ1ZToiLCB0eXBlb2YgdHJ1ZSk7CmNvbnNvbGUubG9nKCJ0eXBlb2YgW106IiwgdHlwZW9mIFtd
KTsKY29uc29sZS5sb2coInR5cGVvZiB7fToiLCB0eXBlb2Yge30pOwpjb25zb2xlLmxvZygidHlw
ZW9mIHVuZGVmaW5lZDoiLCB0eXBlb2YgdW5kZWZpbmVkKTsKY29uc29sZS5sb2coInR5cGVvZiBu
dWxsOiIsIHR5cGVvZiBudWxsKTsKCi8vID09PT09PT09PT0gVEVTVCAxMzogU0lNUExFIEVSUk9S
IEhBTkRMSU5HID09PT09PT09PT0KY29uc29sZS5sb2coIlxu4pqg77iPIFRFU1QgMTM6IEVycm9y
IEhhbmRsaW5nIik7CnRyeSB7CiAgICBsZXQgcmVzdWx0ID0gMTAgLyAwOwogICAgY29uc29sZS5s
b2coIjEwIC8gMCA9IiwgcmVzdWx0KTsKICAgIAogICAgbGV0IHVuZGVmaW5lZFZhcjsKICAgIGNv
bnNvbGUubG9nKCJVbmRlZmluZWQgdmFyaWFibGU6IiwgdW5kZWZpbmVkVmFyKTsKICAgIAogICAg
Ly8gVGhpcyB3aWxsIGNhdXNlIGFuIGVycm9yCiAgICAvLyBsZXQgZXJyb3IgPSBzb21lVW5kZWZp
bmVkRnVuY3Rpb24oKTsKfSBjYXRjaCAoZXJyb3IpIHsKICAgIGNvbnNvbGUubG9nKCJDYXVnaHQg
YW4gZXJyb3IhIik7Cn0gZmluYWxseSB7CiAgICBjb25zb2xlLmxvZygiVGhpcyBhbHdheXMgcnVu
cyIpOwp9CgovLyA9PT09PT09PT09IFRFU1QgMTQ6IERBVEUgQU5EIFRJTUUgPT09PT09PT09PQpj
b25zb2xlLmxvZygiXG7ij7AgVEVTVCAxNDogRGF0ZSBhbmQgVGltZSIpOwpsZXQgbm93ID0gbmV3
IERhdGUoKTsKY29uc29sZS5sb2coIkN1cnJlbnQgZGF0ZToiLCBub3cudG9EYXRlU3RyaW5nKCkp
Owpjb25zb2xlLmxvZygiQ3VycmVudCB0aW1lOiIsIG5vdy50b1RpbWVTdHJpbmcoKSk7CmNvbnNv
bGUubG9nKCJZZWFyOiIsIG5vdy5nZXRGdWxsWWVhcigpKTsKY29uc29sZS5sb2coIk1vbnRoICgw
LTExKToiLCBub3cuZ2V0TW9udGgoKSk7CmNvbnNvbGUubG9nKCJEYXkgb2Ygd2VlazoiLCBub3cu
Z2V0RGF5KCkpOwoKLy8gPT09PT09PT09PSBURVNUIDE1OiBTSU1QTEUgQUxHT1JJVEhNUyA9PT09
PT09PT09CmNvbnNvbGUubG9nKCJcbvCfp64gVEVTVCAxNTogU2ltcGxlIEFsZ29yaXRobXMiKTsK
Ci8vIEV2ZW4gb3Igb2RkCmZ1bmN0aW9uIGlzRXZlbihudW0pIHsKICAgIHJldHVybiBudW0gJSAy
ID09PSAwOwp9CmNvbnNvbGUubG9nKCI0IGlzIGV2ZW4/IiwgaXNFdmVuKDQpKTsKY29uc29sZS5s
b2coIjcgaXMgZXZlbj8iLCBpc0V2ZW4oNykpOwoKLy8gRmluZCBtYXhpbXVtCmZ1bmN0aW9uIGZp
bmRNYXgobnVtYmVycykgewogICAgbGV0IG1heCA9IG51bWJlcnNbMF07CiAgICBmb3IgKGxldCBu
dW0gb2YgbnVtYmVycykgewogICAgICAgIGlmIChudW0gPiBtYXgpIG1heCA9IG51bTsKICAgIH0K
ICAgIHJldHVybiBtYXg7Cn0KY29uc29sZS5sb2coIk1heCBvZiBbMywgMSwgNCwgMl06IiwgZmlu
ZE1heChbMywgMSwgNCwgMl0pKTsKCi8vIFJldmVyc2Ugc3RyaW5nCmZ1bmN0aW9uIHJldmVyc2VT
dHJpbmcoc3RyKSB7CiAgICBsZXQgcmV2ZXJzZWQgPSAiIjsKICAgIGZvciAobGV0IGkgPSBzdHIu
bGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICByZXZlcnNlZCArPSBzdHJbaV07CiAg
ICB9CiAgICByZXR1cm4gcmV2ZXJzZWQ7Cn0KY29uc29sZS5sb2coIlJldmVyc2UgJ2hlbGxvJzoi
LCByZXZlcnNlU3RyaW5nKCJoZWxsbyIpKTsKCi8vID09PT09PT09PT0gRklOQUwgU1VNTUFSWSA9
PT09PT09PT09CmNvbnNvbGUubG9nKCJcbiIgKyAiPSIucmVwZWF0KDQwKSk7CmNvbnNvbGUubG9n
KCLwn46JIEFMTCBCQVNJQyBURVNUUyBDT01QTEVURUQhIik7CmNvbnNvbGUubG9nKCI9Ii5yZXBl
YXQoNDApKTsKY29uc29sZS5sb2coIlxu8J+TiiBUZXN0cyBjb3ZlcmVkOiIpOwpjb25zb2xlLmxv
Zygi4pyFIENvbnNvbGUgbG9nZ2luZyIpOwpjb25zb2xlLmxvZygi4pyFIFZhcmlhYmxlcyAobGV0
LCBjb25zdCwgdmFyKSIpOwpjb25zb2xlLmxvZygi4pyFIEJhc2ljIG1hdGggb3BlcmF0aW9ucyIp
Owpjb25zb2xlLmxvZygi4pyFIFN0cmluZyBvcGVyYXRpb25zIik7CmNvbnNvbGUubG9nKCLinIUg
Qm9vbGVhbiBsb2dpYyIpOwpjb25zb2xlLmxvZygi4pyFIENvbXBhcmlzb25zIik7CmNvbnNvbGUu
bG9nKCLinIUgSWYgc3RhdGVtZW50cyIpOwpjb25zb2xlLmxvZygi4pyFIExvb3BzIChmb3IsIHdo
aWxlKSIpOwpjb25zb2xlLmxvZygi4pyFIEFycmF5cyIpOwpjb25zb2xlLmxvZygi4pyFIE9iamVj
dHMiKTsKY29uc29sZS5sb2coIuKchSBGdW5jdGlvbnMiKTsKY29uc29sZS5sb2coIuKchSBUeXBl
IGNoZWNraW5nIik7CmNvbnNvbGUubG9nKCLinIUgRXJyb3IgaGFuZGxpbmciKTsKY29uc29sZS5s
b2coIuKchSBEYXRlL3RpbWUiKTsKY29uc29sZS5sb2coIuKchSBTaW1wbGUgYWxnb3JpdGhtcyIp
Owpjb25zb2xlLmxvZygiPSIucmVwZWF0KDQwKSk7CmNvbnNvbGUubG9nKCLinKggSmF2YVNjcmlw
dCBiYXNpY3MgbWFzdGVyZWQhIOKcqCIpOwo=
