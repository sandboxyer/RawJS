#!/bin/bash

# Self-extracting JavaScript file generator
# This script will recreate the original JavaScript file

set -e

# Get the original filename from the script name
SCRIPT_NAME="$(basename "$0")"
OUTPUT_FILE="${SCRIPT_NAME%.*}.js"

# Auto-overwrite if file exists (no prompt)
if [ -f "$OUTPUT_FILE" ]; then
    echo "Overwriting existing file: $OUTPUT_FILE"
fi

# Find where the embedded data starts
# Look for the base64 data after the marker
SCRIPT_END_MARKER="#===BEGIN_BASE64_DATA==="

# Get the line number of the marker
MARKER_LINE=$(grep -n "^${SCRIPT_END_MARKER}$" "$0" | cut -d: -f1)

if [ -z "$MARKER_LINE" ]; then
    echo "Error: Could not find embedded data marker" >&2
    exit 1
fi

# Extract the base64 data (starts after the marker)
DATA_START_LINE=$((MARKER_LINE + 1))

# Get all lines from the data start to end of file
# and decode from base64
tail -n +"${DATA_START_LINE}" "$0" | base64 --decode > "$OUTPUT_FILE"

# Verify extraction
if [ $? -eq 0 ]; then
    echo "Successfully created: $OUTPUT_FILE"
    echo "Size: $(wc -c < "$OUTPUT_FILE") bytes"
    
    # Make executable if it starts with shebang
    if head -n1 "$OUTPUT_FILE" | grep -q "^#!"; then
        chmod +x "$OUTPUT_FILE"
        echo "Made executable (has shebang)"
    fi
else
    echo "Error: Failed to extract JavaScript file" >&2
    exit 1
fi

exit 0

#===BEGIN_BASE64_DATA===
LyoqCiAqIEFEVkFOQ0VEIEpBVkFTQ1JJUFQgU1lOVEFYIFRFU1QgU1VJVEUgLSBMRVZFTCAyCiAq
IFRlc3RpbmcgYWR2YW5jZWQgbGFuZ3VhZ2UgZmVhdHVyZXMsIHBhdHRlcm5zLCBhbmQgZWRnZSBj
YXNlcwogKi8KCi8vID09PT09PT09PT0gQURWQU5DRUQgVEVTVCBSVU5ORVIgPT09PT09PT09PQpj
bGFzcyBBZHZhbmNlZFN5bnRheFRlc3QgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgdGhp
cy5zdWl0ZXMgPSBuZXcgTWFwKCk7CiAgICAgICAgdGhpcy5zdGF0cyA9IHsKICAgICAgICAgICAg
c3VpdGVzOiAwLAogICAgICAgICAgICB0ZXN0czogeyB0b3RhbDogMCwgcGFzc2VkOiAwLCBmYWls
ZWQ6IDAgfSwKICAgICAgICAgICAgYXNzZXJ0aW9uczogeyB0b3RhbDogMCwgcGFzc2VkOiAwLCBm
YWlsZWQ6IDAgfQogICAgICAgIH07CiAgICAgICAgdGhpcy5jdXJyZW50U3VpdGUgPSBudWxsOwog
ICAgfQoKICAgIGRlc2NyaWJlKHN1aXRlTmFtZSwgc3VpdGVGbikgewogICAgICAgIHRoaXMuY3Vy
cmVudFN1aXRlID0gewogICAgICAgICAgICBuYW1lOiBzdWl0ZU5hbWUsCiAgICAgICAgICAgIHRl
c3RzOiBbXSwKICAgICAgICAgICAgYmVmb3JlRWFjaDogbnVsbCwKICAgICAgICAgICAgYWZ0ZXJF
YWNoOiBudWxsCiAgICAgICAgfTsKICAgICAgICB0aGlzLnN1aXRlcy5zZXQoc3VpdGVOYW1lLCB0
aGlzLmN1cnJlbnRTdWl0ZSk7CiAgICAgICAgdGhpcy5zdGF0cy5zdWl0ZXMrKzsKICAgICAgICAK
ICAgICAgICBzdWl0ZUZuKCk7CiAgICAgICAgdGhpcy5jdXJyZW50U3VpdGUgPSBudWxsOwogICAg
fQoKICAgIGJlZm9yZUVhY2goZm4pIHsKICAgICAgICBpZiAodGhpcy5jdXJyZW50U3VpdGUpIHRo
aXMuY3VycmVudFN1aXRlLmJlZm9yZUVhY2ggPSBmbjsKICAgIH0KCiAgICBhZnRlckVhY2goZm4p
IHsKICAgICAgICBpZiAodGhpcy5jdXJyZW50U3VpdGUpIHRoaXMuY3VycmVudFN1aXRlLmFmdGVy
RWFjaCA9IGZuOwogICAgfQoKICAgIHRlc3QodGVzdE5hbWUsIHRlc3RGbikgewogICAgICAgIGlm
ICh0aGlzLmN1cnJlbnRTdWl0ZSkgewogICAgICAgICAgICB0aGlzLmN1cnJlbnRTdWl0ZS50ZXN0
cy5wdXNoKHsgbmFtZTogdGVzdE5hbWUsIGZuOiB0ZXN0Rm4gfSk7CiAgICAgICAgICAgIHRoaXMu
c3RhdHMudGVzdHMudG90YWwrKzsKICAgICAgICB9CiAgICB9CgogICAgYXN5bmMgcnVuKCkgewog
ICAgICAgIGNvbnNvbGUubG9nKCfwn6eqIEFEVkFOQ0VEIEpBVkFTQ1JJUFQgU1lOVEFYIFRFU1Qg
U1VJVEUnKTsKICAgICAgICBjb25zb2xlLmxvZygnPScucmVwZWF0KDYwKSk7CiAgICAgICAgY29u
c29sZS5sb2coYPCfk6YgU3VpdGVzOiAke3RoaXMuc3RhdHMuc3VpdGVzfVxuYCk7CgogICAgICAg
IGZvciAoY29uc3QgW3N1aXRlTmFtZSwgc3VpdGVdIG9mIHRoaXMuc3VpdGVzKSB7CiAgICAgICAg
ICAgIGNvbnNvbGUubG9nKGBcbvCfk4EgU1VJVEU6ICR7c3VpdGVOYW1lfWApOwogICAgICAgICAg
ICBjb25zb2xlLmxvZygn4pWQJy5yZXBlYXQoc3VpdGVOYW1lLmxlbmd0aCArIDgpKTsKCiAgICAg
ICAgICAgIGZvciAoY29uc3QgdGVzdCBvZiBzdWl0ZS50ZXN0cykgewogICAgICAgICAgICAgICAg
dHJ5IHsKICAgICAgICAgICAgICAgICAgICBpZiAoc3VpdGUuYmVmb3JlRWFjaCkgc3VpdGUuYmVm
b3JlRWFjaCgpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEhh
bmRsZSBhc3luYyB0ZXN0cwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHRlc3Qu
Zm4oKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICYmIHR5cGVvZiByZXN1bHQudGhl
biA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCByZXN1bHQ7
CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAg
ICAgICAgIGlmIChzdWl0ZS5hZnRlckVhY2gpIHN1aXRlLmFmdGVyRWFjaCgpOwogICAgICAgICAg
ICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAgIOKchSAke3Rlc3Qu
bmFtZX1gKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLnRlc3RzLnBhc3NlZCsrOwog
ICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBjb25z
b2xlLmxvZyhgICDinYwgJHt0ZXN0Lm5hbWV9YCk7CiAgICAgICAgICAgICAgICAgICAgY29uc29s
ZS5sb2coYCAgICAgJHtlcnJvci5tZXNzYWdlfWApOwogICAgICAgICAgICAgICAgICAgIHRoaXMu
c3RhdHMudGVzdHMuZmFpbGVkKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg
ICAgICB9CgogICAgICAgIHRoaXMucmVwb3J0KCk7CiAgICB9CgogICAgcmVwb3J0KCkgewogICAg
ICAgIGNvbnNvbGUubG9nKCdcbicgKyAnPScucmVwZWF0KDYwKSk7CiAgICAgICAgY29uc29sZS5s
b2coJ/Cfk4ogQ09NUFJFSEVOU0lWRSBSRVNVTFRTOicpOwogICAgICAgIGNvbnNvbGUubG9nKGDw
n5OmIFRlc3QgU3VpdGVzOiAke3RoaXMuc3RhdHMuc3VpdGVzfWApOwogICAgICAgIGNvbnNvbGUu
bG9nKGDwn6eqIFRlc3RzOiAke3RoaXMuc3RhdHMudGVzdHMucGFzc2VkfSBwYXNzZWQsICR7dGhp
cy5zdGF0cy50ZXN0cy5mYWlsZWR9IGZhaWxlZCwgJHt0aGlzLnN0YXRzLnRlc3RzLnRvdGFsfSB0
b3RhbGApOwogICAgICAgIGNvbnNvbGUubG9nKGDwn5OdIEFzc2VydGlvbnM6ICR7dGhpcy5zdGF0
cy5hc3NlcnRpb25zLnRvdGFsfSBleGVjdXRlZGApOwogICAgICAgIGNvbnNvbGUubG9nKGDwn4+B
IFN0YXR1czogJHt0aGlzLnN0YXRzLnRlc3RzLmZhaWxlZCA9PT0gMCA/ICfinIUgQUxMIFRFU1RT
IFBBU1NFRCcgOiAn4pqg77iPIFNPTUUgVEVTVFMgRkFJTEVEJ31gKTsKICAgICAgICBjb25zb2xl
LmxvZygnPScucmVwZWF0KDYwKSk7CiAgICB9CgogICAgZXhwZWN0KGFjdHVhbCkgewogICAgICAg
IHJldHVybiBuZXcgRXhwZWN0YXRpb24oYWN0dWFsLCB0aGlzLnN0YXRzKTsKICAgIH0KfQoKY2xh
c3MgRXhwZWN0YXRpb24gewogICAgY29uc3RydWN0b3IoYWN0dWFsLCBzdGF0cykgewogICAgICAg
IHRoaXMuYWN0dWFsID0gYWN0dWFsOwogICAgICAgIHRoaXMuc3RhdHMgPSBzdGF0czsKICAgIH0K
CiAgICB0b0JlKGV4cGVjdGVkKSB7CiAgICAgICAgdGhpcy5zdGF0cy5hc3NlcnRpb25zLnRvdGFs
Kys7CiAgICAgICAgY29uc3QgcGFzcyA9IHRoaXMuYWN0dWFsID09PSBleHBlY3RlZDsKICAgICAg
ICB0aGlzLnN0YXRzLmFzc2VydGlvbnNbcGFzcyA/ICdwYXNzZWQnIDogJ2ZhaWxlZCddKys7CiAg
ICAgICAgaWYgKCFwYXNzKSB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkICR7ZXhwZWN0ZWR9LCBn
b3QgJHt0aGlzLmFjdHVhbH1gKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICB0b0Vx
dWFsKGV4cGVjdGVkKSB7CiAgICAgICAgdGhpcy5zdGF0cy5hc3NlcnRpb25zLnRvdGFsKys7CiAg
ICAgICAgY29uc3QgcGFzcyA9IEpTT04uc3RyaW5naWZ5KHRoaXMuYWN0dWFsKSA9PT0gSlNPTi5z
dHJpbmdpZnkoZXhwZWN0ZWQpOwogICAgICAgIHRoaXMuc3RhdHMuYXNzZXJ0aW9uc1twYXNzID8g
J3Bhc3NlZCcgOiAnZmFpbGVkJ10rKzsKICAgICAgICBpZiAoIXBhc3MpIHRocm93IG5ldyBFcnJv
cihgRXhwZWN0ZWQgJHtKU09OLnN0cmluZ2lmeShleHBlY3RlZCl9LCBnb3QgJHtKU09OLnN0cmlu
Z2lmeSh0aGlzLmFjdHVhbCl9YCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgdG9U
aHJvdyhlcnJvclR5cGUpIHsKICAgICAgICB0aGlzLnN0YXRzLmFzc2VydGlvbnMudG90YWwrKzsK
ICAgICAgICB0cnkgewogICAgICAgICAgICB0aGlzLmFjdHVhbCgpOwogICAgICAgICAgICB0aHJv
dyBuZXcgRXJyb3IoJ0V4cGVjdGVkIGZ1bmN0aW9uIHRvIHRocm93Jyk7CiAgICAgICAgfSBjYXRj
aCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc3QgcGFzcyA9ICFlcnJvclR5cGUgfHwgZXJyb3Ig
aW5zdGFuY2VvZiBlcnJvclR5cGU7CiAgICAgICAgICAgIHRoaXMuc3RhdHMuYXNzZXJ0aW9uc1tw
YXNzID8gJ3Bhc3NlZCcgOiAnZmFpbGVkJ10rKzsKICAgICAgICAgICAgaWYgKCFwYXNzKSB0aHJv
dyBuZXcgRXJyb3IoYEV4cGVjdGVkICR7ZXJyb3JUeXBlPy5uYW1lIHx8ICdlcnJvcid9LCBnb3Qg
JHtlcnJvci5jb25zdHJ1Y3Rvci5uYW1lfWApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhp
czsKICAgIH0KCiAgICByZXNvbHZlc1RvKGV4cGVjdGVkKSB7CiAgICAgICAgdGhpcy5zdGF0cy5h
c3NlcnRpb25zLnRvdGFsKys7CiAgICAgICAgcmV0dXJuIHRoaXMuYWN0dWFsLnRoZW4ocmVzdWx0
ID0+IHsKICAgICAgICAgICAgY29uc3QgcGFzcyA9IHJlc3VsdCA9PT0gZXhwZWN0ZWQ7CiAgICAg
ICAgICAgIHRoaXMuc3RhdHMuYXNzZXJ0aW9uc1twYXNzID8gJ3Bhc3NlZCcgOiAnZmFpbGVkJ10r
KzsKICAgICAgICAgICAgaWYgKCFwYXNzKSB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIHByb21p
c2UgdG8gcmVzb2x2ZSB0byAke2V4cGVjdGVkfSwgZ290ICR7cmVzdWx0fWApOwogICAgICAgIH0p
OwogICAgfQp9Cgpjb25zdCBhZHZhbmNlZFRlc3RlciA9IG5ldyBBZHZhbmNlZFN5bnRheFRlc3Qo
KTsKCi8vID09PT09PT09PT0gQURWQU5DRUQgRlVOQ1RJT04gRkVBVFVSRVMgPT09PT09PT09PQph
ZHZhbmNlZFRlc3Rlci5kZXNjcmliZSgnQWR2YW5jZWQgRnVuY3Rpb25zJywgKCkgPT4gewogICAg
YWR2YW5jZWRUZXN0ZXIudGVzdCgnR2VuZXJhdG9yIEZ1bmN0aW9ucycsICgpID0+IHsKICAgICAg
ICBmdW5jdGlvbiogbnVtYmVyR2VuZXJhdG9yKCkgewogICAgICAgICAgICB5aWVsZCAxOwogICAg
ICAgICAgICB5aWVsZCAyOwogICAgICAgICAgICB5aWVsZCAzOwogICAgICAgIH0KICAgICAgICAK
ICAgICAgICBjb25zdCBnZW4gPSBudW1iZXJHZW5lcmF0b3IoKTsKICAgICAgICBhZHZhbmNlZFRl
c3Rlci5leHBlY3QoZ2VuLm5leHQoKS52YWx1ZSkudG9CZSgxKTsKICAgICAgICBhZHZhbmNlZFRl
c3Rlci5leHBlY3QoZ2VuLm5leHQoKS52YWx1ZSkudG9CZSgyKTsKICAgICAgICBhZHZhbmNlZFRl
c3Rlci5leHBlY3QoZ2VuLm5leHQoKS52YWx1ZSkudG9CZSgzKTsKICAgICAgICBhZHZhbmNlZFRl
c3Rlci5leHBlY3QoZ2VuLm5leHQoKS5kb25lKS50b0JlKHRydWUpOwogICAgfSk7CgogICAgYWR2
YW5jZWRUZXN0ZXIudGVzdCgnQXN5bmMgR2VuZXJhdG9ycycsIGFzeW5jICgpID0+IHsKICAgICAg
ICBhc3luYyBmdW5jdGlvbiogYXN5bmNDb3VudGVyKGxpbWl0KSB7CiAgICAgICAgICAgIGZvciAo
bGV0IGkgPSAxOyBpIDw9IGxpbWl0OyBpKyspIHsKICAgICAgICAgICAgICAgIGF3YWl0IG5ldyBQ
cm9taXNlKHIgPT4gc2V0VGltZW91dChyLCAxMCkpOwogICAgICAgICAgICAgICAgeWllbGQgaTsK
ICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb25zdCByZXN1bHRzID0g
W107CiAgICAgICAgZm9yIGF3YWl0IChjb25zdCBudW0gb2YgYXN5bmNDb3VudGVyKDMpKSB7CiAg
ICAgICAgICAgIHJlc3VsdHMucHVzaChudW0pOwogICAgICAgIH0KICAgICAgICBhZHZhbmNlZFRl
c3Rlci5leHBlY3QocmVzdWx0cykudG9FcXVhbChbMSwgMiwgM10pOwogICAgfSk7CgogICAgYWR2
YW5jZWRUZXN0ZXIudGVzdCgnRnVuY3Rpb24gQ3VycnlpbmcnLCAoKSA9PiB7CiAgICAgICAgY29u
c3QgY3VycnkgPSBmbiA9PiB7CiAgICAgICAgICAgIGNvbnN0IGN1cnJpZWQgPSAoLi4uYXJncykg
PT4gewogICAgICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID49IGZuLmxlbmd0aCkgewogICAg
ICAgICAgICAgICAgICAgIHJldHVybiBmbiguLi5hcmdzKTsKICAgICAgICAgICAgICAgIH0KICAg
ICAgICAgICAgICAgIHJldHVybiAoLi4ubW9yZUFyZ3MpID0+IGN1cnJpZWQoLi4uYXJncywgLi4u
bW9yZUFyZ3MpOwogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gY3VycmllZDsKICAg
ICAgICB9OwogICAgICAgIAogICAgICAgIGNvbnN0IGFkZCA9IGN1cnJ5KChhLCBiLCBjKSA9PiBh
ICsgYiArIGMpOwogICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVjdChhZGQoMSkoMikoMykpLnRv
QmUoNik7CiAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0KGFkZCgxLCAyKSgzKSkudG9CZSg2
KTsKICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBlY3QoYWRkKDEsIDIsIDMpKS50b0JlKDYpOwog
ICAgfSk7CgogICAgYWR2YW5jZWRUZXN0ZXIudGVzdCgnTWVtb2l6YXRpb24gUGF0dGVybicsICgp
ID0+IHsKICAgICAgICBsZXQgY29tcHV0YXRpb25Db3VudCA9IDA7CiAgICAgICAgY29uc3QgbWVt
b2l6ZSA9IGZuID0+IHsKICAgICAgICAgICAgY29uc3QgY2FjaGUgPSBuZXcgTWFwKCk7CiAgICAg
ICAgICAgIHJldHVybiAoLi4uYXJncykgPT4gewogICAgICAgICAgICAgICAgY29uc3Qga2V5ID0g
SlNPTi5zdHJpbmdpZnkoYXJncyk7CiAgICAgICAgICAgICAgICBpZiAoY2FjaGUuaGFzKGtleSkp
IHJldHVybiBjYWNoZS5nZXQoa2V5KTsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZu
KC4uLmFyZ3MpOwogICAgICAgICAgICAgICAgY2FjaGUuc2V0KGtleSwgcmVzdWx0KTsKICAgICAg
ICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgIH07CiAgICAgICAgfTsKICAgICAg
ICAKICAgICAgICBjb25zdCBleHBlbnNpdmUgPSBtZW1vaXplKChhLCBiKSA9PiB7CiAgICAgICAg
ICAgIGNvbXB1dGF0aW9uQ291bnQrKzsKICAgICAgICAgICAgcmV0dXJuIGEgKyBiOwogICAgICAg
IH0pOwogICAgICAgIAogICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVjdChleHBlbnNpdmUoMSwg
MikpLnRvQmUoMyk7CiAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0KGV4cGVuc2l2ZSgxLCAy
KSkudG9CZSgzKTsgLy8gU2hvdWxkIHVzZSBjYWNoZQogICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4
cGVjdChjb21wdXRhdGlvbkNvdW50KS50b0JlKDEpOyAvLyBPbmx5IGNvbXB1dGVkIG9uY2UKICAg
IH0pOwoKICAgIGFkdmFuY2VkVGVzdGVyLnRlc3QoJ0Z1bmN0aW9uIENvbXBvc2l0aW9uJywgKCkg
PT4gewogICAgICAgIGNvbnN0IGNvbXBvc2UgPSAoLi4uZm5zKSA9PiB4ID0+IGZucy5yZWR1Y2VS
aWdodCgoYWNjLCBmbikgPT4gZm4oYWNjKSwgeCk7CiAgICAgICAgY29uc3QgcGlwZSA9ICguLi5m
bnMpID0+IHggPT4gZm5zLnJlZHVjZSgoYWNjLCBmbikgPT4gZm4oYWNjKSwgeCk7CiAgICAgICAg
CiAgICAgICAgY29uc3QgYWRkNSA9IHggPT4geCArIDU7CiAgICAgICAgY29uc3QgbXVsdGlwbHkz
ID0geCA9PiB4ICogMzsKICAgICAgICBjb25zdCBzdWJ0cmFjdDIgPSB4ID0+IHggLSAyOwogICAg
ICAgIAogICAgICAgIGNvbnN0IGNvbXBvc2VkID0gY29tcG9zZShzdWJ0cmFjdDIsIG11bHRpcGx5
MywgYWRkNSk7CiAgICAgICAgY29uc3QgcGlwZWQgPSBwaXBlKGFkZDUsIG11bHRpcGx5Mywgc3Vi
dHJhY3QyKTsKICAgICAgICAKICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBlY3QoY29tcG9zZWQo
MTApKS50b0JlKDQzKTsgLy8gKCgxMCArIDUpICogMykgLSAyCiAgICAgICAgYWR2YW5jZWRUZXN0
ZXIuZXhwZWN0KHBpcGVkKDEwKSkudG9CZSg0Myk7ICAgIC8vICgoMTAgKyA1KSAqIDMpIC0gMgog
ICAgfSk7Cn0pOwoKLy8gPT09PT09PT09PSBBRFZBTkNFRCBPQkpFQ1QgRkVBVFVSRVMgPT09PT09
PT09PQphZHZhbmNlZFRlc3Rlci5kZXNjcmliZSgnQWR2YW5jZWQgT2JqZWN0cycsICgpID0+IHsK
ICAgIGFkdmFuY2VkVGVzdGVyLnRlc3QoJ1Byb3RvdHlwYWwgSW5oZXJpdGFuY2UnLCAoKSA9PiB7
CiAgICAgICAgZnVuY3Rpb24gQW5pbWFsKG5hbWUpIHsKICAgICAgICAgICAgdGhpcy5uYW1lID0g
bmFtZTsKICAgICAgICB9CiAgICAgICAgQW5pbWFsLnByb3RvdHlwZS5zcGVhayA9IGZ1bmN0aW9u
KCkgeyByZXR1cm4gYCR7dGhpcy5uYW1lfSBtYWtlcyBhIHNvdW5kYDsgfTsKICAgICAgICAKICAg
ICAgICBmdW5jdGlvbiBEb2cobmFtZSwgYnJlZWQpIHsKICAgICAgICAgICAgQW5pbWFsLmNhbGwo
dGhpcywgbmFtZSk7CiAgICAgICAgICAgIHRoaXMuYnJlZWQgPSBicmVlZDsKICAgICAgICB9CiAg
ICAgICAgRG9nLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQW5pbWFsLnByb3RvdHlwZSk7CiAg
ICAgICAgRG9nLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IERvZzsKICAgICAgICBEb2cucHJvdG90
eXBlLmJhcmsgPSBmdW5jdGlvbigpIHsgcmV0dXJuIGAke3RoaXMubmFtZX0gYmFya3MhYDsgfTsK
ICAgICAgICAKICAgICAgICBjb25zdCBkb2cgPSBuZXcgRG9nKCdSZXgnLCAnR2VybWFuIFNoZXBo
ZXJkJyk7CiAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0KGRvZy5zcGVhaygpKS50b0JlKCdS
ZXggbWFrZXMgYSBzb3VuZCcpOwogICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVjdChkb2cuYmFy
aygpKS50b0JlKCdSZXggYmFya3MhJyk7CiAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0KGRv
ZyBpbnN0YW5jZW9mIERvZykudG9CZSh0cnVlKTsKICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBl
Y3QoZG9nIGluc3RhbmNlb2YgQW5pbWFsKS50b0JlKHRydWUpOwogICAgfSk7CgogICAgYWR2YW5j
ZWRUZXN0ZXIudGVzdCgnQ2xhc3NlcyBhbmQgSW5oZXJpdGFuY2UnLCAoKSA9PiB7CiAgICAgICAg
Y2xhc3MgU2hhcGUgewogICAgICAgICAgICBjb25zdHJ1Y3Rvcihjb2xvcikgeyB0aGlzLmNvbG9y
ID0gY29sb3I7IH0KICAgICAgICAgICAgZGVzY3JpYmUoKSB7IHJldHVybiBgQSAke3RoaXMuY29s
b3J9IHNoYXBlYDsgfQogICAgICAgICAgICBzdGF0aWMgY3JlYXRlRGVmYXVsdCgpIHsgcmV0dXJu
IG5ldyBTaGFwZSgnYmxhY2snKTsgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBjbGFzcyBD
aXJjbGUgZXh0ZW5kcyBTaGFwZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKGNvbG9yLCByYWRp
dXMpIHsKICAgICAgICAgICAgICAgIHN1cGVyKGNvbG9yKTsKICAgICAgICAgICAgICAgIHRoaXMu
cmFkaXVzID0gcmFkaXVzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFyZWEoKSB7IHJldHVy
biBNYXRoLlBJICogdGhpcy5yYWRpdXMgKiogMjsgfQogICAgICAgIH0KICAgICAgICAKICAgICAg
ICBjb25zdCBjaXJjbGUgPSBuZXcgQ2lyY2xlKCdyZWQnLCA1KTsKICAgICAgICBhZHZhbmNlZFRl
c3Rlci5leHBlY3QoY2lyY2xlLmFyZWEoKSkudG9CZShNYXRoLlBJICogMjUpOwogICAgICAgIGFk
dmFuY2VkVGVzdGVyLmV4cGVjdChjaXJjbGUuZGVzY3JpYmUoKSkudG9CZSgnQSByZWQgc2hhcGUn
KTsKICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBlY3QoY2lyY2xlIGluc3RhbmNlb2YgQ2lyY2xl
KS50b0JlKHRydWUpOwogICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVjdChjaXJjbGUgaW5zdGFu
Y2VvZiBTaGFwZSkudG9CZSh0cnVlKTsKICAgICAgICAKICAgICAgICBjb25zdCBkZWZhdWx0U2hh
cGUgPSBTaGFwZS5jcmVhdGVEZWZhdWx0KCk7CiAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0
KGRlZmF1bHRTaGFwZS5jb2xvcikudG9CZSgnYmxhY2snKTsKICAgIH0pOwoKICAgIGFkdmFuY2Vk
VGVzdGVyLnRlc3QoJ1N5bWJvbHMgYXMgUHJpdmF0ZSBQcm9wZXJ0aWVzJywgKCkgPT4gewogICAg
ICAgIGNvbnN0IF9jb3VudGVyID0gU3ltYm9sKCdjb3VudGVyJyk7CiAgICAgICAgY29uc3QgX2lu
Y3JlbWVudCA9IFN5bWJvbCgnaW5jcmVtZW50Jyk7CiAgICAgICAgCiAgICAgICAgY2xhc3MgQ291
bnRlciB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICAgICAgdGhpc1tf
Y291bnRlcl0gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBbX2lu
Y3JlbWVudF0oKSB7CiAgICAgICAgICAgICAgICB0aGlzW19jb3VudGVyXSsrOwogICAgICAgICAg
ICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpbmNyZW1lbnQoKSB7CiAgICAgICAgICAgICAg
ICB0aGlzW19pbmNyZW1lbnRdKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1tfY291bnRl
cl07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGdldCB2YWx1ZSgpIHsK
ICAgICAgICAgICAgICAgIHJldHVybiB0aGlzW19jb3VudGVyXTsKICAgICAgICAgICAgfQogICAg
ICAgIH0KICAgICAgICAKICAgICAgICBjb25zdCBjb3VudGVyID0gbmV3IENvdW50ZXIoKTsKICAg
ICAgICBhZHZhbmNlZFRlc3Rlci5leHBlY3QoY291bnRlci5pbmNyZW1lbnQoKSkudG9CZSgxKTsK
ICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBlY3QoY291bnRlci52YWx1ZSkudG9CZSgxKTsKICAg
ICAgICAKICAgICAgICAvLyBDaGVjayB0aGF0IHN5bWJvbHMgZXhpc3QgYXMgcHJvcGVydGllcwog
ICAgICAgIGNvbnN0IHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGNvdW50
ZXIpOwogICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVjdChzeW1ib2xzLmxlbmd0aCkudG9CZSgy
KTsKICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBlY3Qoc3ltYm9scy5pbmNsdWRlcyhfY291bnRl
cikpLnRvQmUodHJ1ZSk7CiAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0KHN5bWJvbHMuaW5j
bHVkZXMoX2luY3JlbWVudCkpLnRvQmUodHJ1ZSk7CiAgICB9KTsKCiAgICBhZHZhbmNlZFRlc3Rl
ci50ZXN0KCdQcm94aWVzIGFuZCBSZWZsZWN0JywgKCkgPT4gewogICAgICAgIGNvbnN0IHRhcmdl
dCA9IHsgbmFtZTogJ0pvaG4nLCBhZ2U6IDMwIH07CiAgICAgICAgCiAgICAgICAgY29uc3QgaGFu
ZGxlciA9IHsKICAgICAgICAgICAgZ2V0KG9iaiwgcHJvcCkgewogICAgICAgICAgICAgICAgaWYg
KHByb3AgPT09ICdhZ2UnKSByZXR1cm4gYEFnZTogJHtvYmpbcHJvcF19YDsKICAgICAgICAgICAg
ICAgIGlmIChwcm9wID09PSAnZ3JlZXQnKSByZXR1cm4gKCkgPT4gYEhlbGxvICR7b2JqLm5hbWV9
YDsKICAgICAgICAgICAgICAgIHJldHVybiBSZWZsZWN0LmdldChvYmosIHByb3ApOwogICAgICAg
ICAgICB9LAogICAgICAgICAgICBzZXQob2JqLCBwcm9wLCB2YWx1ZSkgewogICAgICAgICAgICAg
ICAgaWYgKHByb3AgPT09ICdhZ2UnICYmIHZhbHVlIDwgMCkgewogICAgICAgICAgICAgICAgICAg
IHRocm93IG5ldyBFcnJvcignQWdlIGNhbm5vdCBiZSBuZWdhdGl2ZScpOwogICAgICAgICAgICAg
ICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIFJlZmxlY3Quc2V0KG9iaiwgcHJvcCwgdmFsdWUp
OwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICBjb25zdCBwcm94eSA9
IG5ldyBQcm94eSh0YXJnZXQsIGhhbmRsZXIpOwogICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVj
dChwcm94eS5hZ2UpLnRvQmUoJ0FnZTogMzAnKTsKICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBl
Y3QocHJveHkuZ3JlZXQoKSkudG9CZSgnSGVsbG8gSm9obicpOwogICAgICAgIAogICAgICAgIHRy
eSB7CiAgICAgICAgICAgIHByb3h5LmFnZSA9IC01OwogICAgICAgICAgICB0aHJvdyBuZXcgRXJy
b3IoJ1Nob3VsZCBoYXZlIHRocm93bicpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAg
ICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVjdChlcnJvci5tZXNzYWdlKS50b0JlKCdBZ2UgY2Fu
bm90IGJlIG5lZ2F0aXZlJyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIENhbiBzdGls
bCBzZXQgdmFsaWQgdmFsdWVzCiAgICAgICAgcHJveHkuYWdlID0gMzU7CiAgICAgICAgYWR2YW5j
ZWRUZXN0ZXIuZXhwZWN0KHByb3h5LmFnZSkudG9CZSgnQWdlOiAzNScpOwogICAgfSk7CgogICAg
YWR2YW5jZWRUZXN0ZXIudGVzdCgnT2JqZWN0IFByb3BlcnR5IERlc2NyaXB0b3JzJywgKCkgPT4g
ewogICAgICAgIGNvbnN0IG9iaiA9IHt9OwogICAgICAgIAogICAgICAgIE9iamVjdC5kZWZpbmVQ
cm9wZXJ0aWVzKG9iaiwgewogICAgICAgICAgICByZWFkT25seTogewogICAgICAgICAgICAgICAg
dmFsdWU6IDQyLAogICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlLAogICAgICAgICAgICAg
ICAgZW51bWVyYWJsZTogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBoaWRkZW46IHsK
ICAgICAgICAgICAgICAgIHZhbHVlOiAnc2VjcmV0JywKICAgICAgICAgICAgICAgIGVudW1lcmFi
bGU6IGZhbHNlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNvbXB1dGVkOiB7CiAgICAgICAg
ICAgICAgICBnZXQoKSB7IHJldHVybiB0aGlzLnJlYWRPbmx5ICogMjsgfSwKICAgICAgICAgICAg
ICAgIGVudW1lcmFibGU6IHRydWUKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIAog
ICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVjdChvYmoucmVhZE9ubHkpLnRvQmUoNDIpOwogICAg
ICAgIG9iai5yZWFkT25seSA9IDEwMDsKICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBlY3Qob2Jq
LnJlYWRPbmx5KS50b0JlKDQyKTsgLy8gRGlkbid0IGNoYW5nZQogICAgICAgIAogICAgICAgIGFk
dmFuY2VkVGVzdGVyLmV4cGVjdChPYmplY3Qua2V5cyhvYmopKS50b0VxdWFsKFsncmVhZE9ubHkn
LCAnY29tcHV0ZWQnXSk7CiAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0KG9iai5oaWRkZW4p
LnRvQmUoJ3NlY3JldCcpOwogICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVjdChvYmouY29tcHV0
ZWQpLnRvQmUoODQpOwogICAgICAgIAogICAgICAgIC8vIFNlYWwgYW5kIGZyZWV6ZQogICAgICAg
IGNvbnN0IHNlYWxlZCA9IHsgYTogMSwgYjogMiB9OwogICAgICAgIE9iamVjdC5zZWFsKHNlYWxl
ZCk7CiAgICAgICAgc2VhbGVkLmEgPSAzOyAvLyBDYW4gbW9kaWZ5CiAgICAgICAgYWR2YW5jZWRU
ZXN0ZXIuZXhwZWN0KHNlYWxlZC5hKS50b0JlKDMpOwogICAgICAgIAogICAgICAgIGRlbGV0ZSBz
ZWFsZWQuYjsgLy8gQ2Fubm90IGRlbGV0ZQogICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVjdChz
ZWFsZWQuYikudG9CZSgyKTsKICAgICAgICAKICAgICAgICBjb25zdCBmcm96ZW4gPSB7IHg6IDEs
IHk6IDIgfTsKICAgICAgICBPYmplY3QuZnJlZXplKGZyb3plbik7CiAgICAgICAgZnJvemVuLngg
PSAzOyAvLyBDYW5ub3QgbW9kaWZ5CiAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0KGZyb3pl
bi54KS50b0JlKDEpOwogICAgfSk7Cn0pOwoKLy8gPT09PT09PT09PSBBRFZBTkNFRCBBUlJBWSBG
RUFUVVJFUyA9PT09PT09PT09CmFkdmFuY2VkVGVzdGVyLmRlc2NyaWJlKCdBZHZhbmNlZCBBcnJh
eXMnLCAoKSA9PiB7CiAgICBhZHZhbmNlZFRlc3Rlci50ZXN0KCdUeXBlZCBBcnJheXMnLCAoKSA9
PiB7CiAgICAgICAgY29uc3QgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKDE2KTsKICAgICAgICBj
b25zdCBpbnQzMlZpZXcgPSBuZXcgSW50MzJBcnJheShidWZmZXIpOwogICAgICAgIAogICAgICAg
IGZvciAobGV0IGkgPSAwOyBpIDwgaW50MzJWaWV3Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg
IGludDMyVmlld1tpXSA9IGkgKiAyOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBhZHZhbmNl
ZFRlc3Rlci5leHBlY3QoaW50MzJWaWV3Lmxlbmd0aCkudG9CZSg0KTsKICAgICAgICBhZHZhbmNl
ZFRlc3Rlci5leHBlY3QoaW50MzJWaWV3WzJdKS50b0JlKDQpOwogICAgICAgIAogICAgICAgIGNv
bnN0IGZsb2F0NjRWaWV3ID0gbmV3IEZsb2F0NjRBcnJheShidWZmZXIsIDAsIDIpOwogICAgICAg
IGFkdmFuY2VkVGVzdGVyLmV4cGVjdChmbG9hdDY0Vmlldy5CWVRFU19QRVJfRUxFTUVOVCkudG9C
ZSg4KTsKICAgIH0pOwoKICAgIGFkdmFuY2VkVGVzdGVyLnRlc3QoJ0FycmF5LmZyb20gd2l0aCBN
YXAgRnVuY3Rpb24nLCAoKSA9PiB7CiAgICAgICAgY29uc3Qgc2V0ID0gbmV3IFNldChbMSwgMiwg
M10pOwogICAgICAgIGNvbnN0IGRvdWJsZWQgPSBBcnJheS5mcm9tKHNldCwgeCA9PiB4ICogMik7
CiAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0KGRvdWJsZWQpLnRvRXF1YWwoWzIsIDQsIDZd
KTsKICAgICAgICAKICAgICAgICBjb25zdCBmcm9tU3RyaW5nID0gQXJyYXkuZnJvbSgnaGVsbG8n
LCAoY2hhciwgaW5kZXgpID0+IGAke2NoYXIudG9VcHBlckNhc2UoKX0ke2luZGV4fWApOwogICAg
ICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVjdChmcm9tU3RyaW5nKS50b0VxdWFsKFsnSDAnLCAnRTEn
LCAnTDInLCAnTDMnLCAnTzQnXSk7CiAgICAgICAgCiAgICAgICAgY29uc3QgZnJvbUFycmF5TGlr
ZSA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDUgfSwgKF8sIGkpID0+IGkgKiBpKTsKICAgICAgICBh
ZHZhbmNlZFRlc3Rlci5leHBlY3QoZnJvbUFycmF5TGlrZSkudG9FcXVhbChbMCwgMSwgNCwgOSwg
MTZdKTsKICAgIH0pOwoKICAgIGFkdmFuY2VkVGVzdGVyLnRlc3QoJ0FycmF5IE1ldGhvZHMgd2l0
aCBDb21wbGV4IExvZ2ljJywgKCkgPT4gewogICAgICAgIGNvbnN0IGRhdGEgPSBbCiAgICAgICAg
ICAgIHsgaWQ6IDEsIHZhbHVlOiAxMCwgdGFnczogWydhJywgJ2InXSB9LAogICAgICAgICAgICB7
IGlkOiAyLCB2YWx1ZTogMjAsIHRhZ3M6IFsnYicsICdjJ10gfSwKICAgICAgICAgICAgeyBpZDog
MywgdmFsdWU6IDMwLCB0YWdzOiBbJ2EnLCAnYyddIH0sCiAgICAgICAgICAgIHsgaWQ6IDQsIHZh
bHVlOiA0MCwgdGFnczogWydkJ10gfQogICAgICAgIF07CiAgICAgICAgCiAgICAgICAgLy8gQ2hh
aW5pbmcgbWV0aG9kcwogICAgICAgIGNvbnN0IHJlc3VsdCA9IGRhdGEKICAgICAgICAgICAgLmZp
bHRlcihpdGVtID0+IGl0ZW0udmFsdWUgPiAxNSkKICAgICAgICAgICAgLmZsYXRNYXAoaXRlbSA9
PiBpdGVtLnRhZ3MubWFwKHRhZyA9PiAoeyB0YWcsIHZhbHVlOiBpdGVtLnZhbHVlIH0pKSkKICAg
ICAgICAgICAgLnJlZHVjZSgoYWNjLCB7IHRhZywgdmFsdWUgfSkgPT4gewogICAgICAgICAgICAg
ICAgYWNjW3RhZ10gPSAoYWNjW3RhZ10gfHwgMCkgKyB2YWx1ZTsKICAgICAgICAgICAgICAgIHJl
dHVybiBhY2M7CiAgICAgICAgICAgIH0sIHt9KTsKICAgICAgICAKICAgICAgICBhZHZhbmNlZFRl
c3Rlci5leHBlY3QocmVzdWx0KS50b0VxdWFsKHsgYjogMjAsIGM6IDUwLCBhOiAzMCwgZDogNDAg
fSk7CiAgICAgICAgCiAgICAgICAgLy8gZmluZEluZGV4IHdpdGggY29tcGxleCBwcmVkaWNhdGUK
ICAgICAgICBjb25zdCBpbmRleCA9IGRhdGEuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS50YWdzLmlu
Y2x1ZGVzKCdiJykgJiYgaXRlbS52YWx1ZSA+IDE1KTsKICAgICAgICBhZHZhbmNlZFRlc3Rlci5l
eHBlY3QoaW5kZXgpLnRvQmUoMSk7CiAgICAgICAgCiAgICAgICAgLy8gc29ydCB3aXRoIHNpbXBs
ZSBjb21wYXJpc29uIChyZW1vdmluZyBsb2NhbGUtc3BlY2lmaWMgdGVzdCkKICAgICAgICBjb25z
dCBzdHJpbmdzID0gWyd6JywgJ2EnLCAnYycsICdiJ107CiAgICAgICAgY29uc3Qgc29ydGVkID0g
c3RyaW5ncy5zb3J0KCk7CiAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0KHNvcnRlZCkudG9F
cXVhbChbJ2EnLCAnYicsICdjJywgJ3onXSk7CiAgICB9KTsKCiAgICBhZHZhbmNlZFRlc3Rlci50
ZXN0KCdBcnJheSBEZXN0cnVjdHVyaW5nIFBhdHRlcm5zJywgKCkgPT4gewogICAgICAgIGNvbnN0
IG1hdHJpeCA9IFsKICAgICAgICAgICAgWzEsIDIsIDNdLAogICAgICAgICAgICBbNCwgNSwgNl0s
CiAgICAgICAgICAgIFs3LCA4LCA5XQogICAgICAgIF07CiAgICAgICAgCiAgICAgICAgLy8gTmVz
dGVkIGRlc3RydWN0dXJpbmcKICAgICAgICBjb25zdCBbW2ZpcnN0Um93Rmlyc3RdLCBbLCBzZWNv
bmRSb3dTZWNvbmRdLCBbLCAsIHRoaXJkUm93VGhpcmRdXSA9IG1hdHJpeDsKICAgICAgICBhZHZh
bmNlZFRlc3Rlci5leHBlY3QoZmlyc3RSb3dGaXJzdCkudG9CZSgxKTsKICAgICAgICBhZHZhbmNl
ZFRlc3Rlci5leHBlY3Qoc2Vjb25kUm93U2Vjb25kKS50b0JlKDUpOwogICAgICAgIGFkdmFuY2Vk
VGVzdGVyLmV4cGVjdCh0aGlyZFJvd1RoaXJkKS50b0JlKDkpOwogICAgICAgIAogICAgICAgIC8v
IERlc3RydWN0dXJpbmcgd2l0aCByZXN0IGFuZCBkZWZhdWx0cwogICAgICAgIGNvbnN0IFtmaXJz
dCwgc2Vjb25kID0gJ2RlZmF1bHQnLCAuLi5yZXN0XSA9IFsnYSddOwogICAgICAgIGFkdmFuY2Vk
VGVzdGVyLmV4cGVjdChmaXJzdCkudG9CZSgnYScpOwogICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4
cGVjdChzZWNvbmQpLnRvQmUoJ2RlZmF1bHQnKTsKICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBl
Y3QocmVzdCkudG9FcXVhbChbXSk7CiAgICAgICAgCiAgICAgICAgLy8gU3dhcHBpbmcgd2l0aCBk
ZXN0cnVjdHVyaW5nCiAgICAgICAgbGV0IHggPSAxLCB5ID0gMiwgeiA9IDM7CiAgICAgICAgW3gs
IHksIHpdID0gW3osIHksIHhdOwogICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVjdChbeCwgeSwg
el0pLnRvRXF1YWwoWzMsIDIsIDFdKTsKICAgIH0pOwp9KTsKCi8vID09PT09PT09PT0gQURWQU5D
RUQgSVRFUkFUT1JTIEFORCBHRU5FUkFUT1JTID09PT09PT09PT0KYWR2YW5jZWRUZXN0ZXIuZGVz
Y3JpYmUoJ0l0ZXJhdG9ycyAmIEdlbmVyYXRvcnMnLCAoKSA9PiB7CiAgICBhZHZhbmNlZFRlc3Rl
ci50ZXN0KCdDdXN0b20gSXRlcmF0b3JzJywgKCkgPT4gewogICAgICAgIGNsYXNzIFJhbmdlIHsK
ICAgICAgICAgICAgY29uc3RydWN0b3Ioc3RhcnQsIGVuZCwgc3RlcCA9IDEpIHsKICAgICAgICAg
ICAgICAgIHRoaXMuc3RhcnQgPSBzdGFydDsKICAgICAgICAgICAgICAgIHRoaXMuZW5kID0gZW5k
OwogICAgICAgICAgICAgICAgdGhpcy5zdGVwID0gc3RlcDsKICAgICAgICAgICAgfQogICAgICAg
ICAgICAKICAgICAgICAgICAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7CiAgICAgICAgICAgICAgICBs
ZXQgY3VycmVudCA9IHRoaXMuc3RhcnQ7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAg
ICAgICAgICAgICAgIG5leHQ6ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1
cnJlbnQgPD0gdGhpcy5lbmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZh
bHVlID0gY3VycmVudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgKz0gdGhp
cy5zdGVwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWUsIGRvbmU6
IGZhbHNlIH07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAg
ICAgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg
ICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY29uc3Qg
cmFuZ2UgPSBuZXcgUmFuZ2UoMSwgNSk7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gWy4uLnJhbmdl
XTsKICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBlY3QocmVzdWx0KS50b0VxdWFsKFsxLCAyLCAz
LCA0LCA1XSk7CiAgICAgICAgCiAgICAgICAgLy8gR2VuZXJhdG9yIGFzIGl0ZXJhdG9yCiAgICAg
ICAgY29uc3QgcmFuZ2VHZW4gPSBmdW5jdGlvbiooc3RhcnQsIGVuZCkgewogICAgICAgICAgICBm
b3IgKGxldCBpID0gc3RhcnQ7IGkgPD0gZW5kOyBpKyspIHlpZWxkIGk7CiAgICAgICAgfTsKICAg
ICAgICBhZHZhbmNlZFRlc3Rlci5leHBlY3QoWy4uLnJhbmdlR2VuKDEsIDMpXSkudG9FcXVhbChb
MSwgMiwgM10pOwogICAgfSk7CgogICAgYWR2YW5jZWRUZXN0ZXIudGVzdCgnQXN5bmMgSXRlcmF0
b3JzJywgYXN5bmMgKCkgPT4gewogICAgICAgIGNsYXNzIEFzeW5jRGF0YUZldGNoZXIgewogICAg
ICAgICAgICBjb25zdHJ1Y3RvcihkYXRhLCBkZWxheSA9IDEwMCkgewogICAgICAgICAgICAgICAg
dGhpcy5kYXRhID0gZGF0YTsKICAgICAgICAgICAgICAgIHRoaXMuZGVsYXkgPSBkZWxheTsKICAg
ICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYXN5bmMgKltTeW1ib2wuYXN5bmNJ
dGVyYXRvcl0oKSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5kYXRh
KSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0
KHIsIHRoaXMuZGVsYXkpKTsKICAgICAgICAgICAgICAgICAgICB5aWVsZCBpdGVtOwogICAgICAg
ICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnN0
IGZldGNoZXIgPSBuZXcgQXN5bmNEYXRhRmV0Y2hlcihbJ2EnLCAnYicsICdjJ10sIDEwKTsKICAg
ICAgICBjb25zdCByZXN1bHRzID0gW107CiAgICAgICAgCiAgICAgICAgZm9yIGF3YWl0IChjb25z
dCBpdGVtIG9mIGZldGNoZXIpIHsKICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGl0ZW0pOwogICAg
ICAgIH0KICAgICAgICAKICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBlY3QocmVzdWx0cykudG9F
cXVhbChbJ2EnLCAnYicsICdjJ10pOwogICAgfSk7CgogICAgYWR2YW5jZWRUZXN0ZXIudGVzdCgn
R2VuZXJhdG9yIENvbnRyb2wgRmxvdycsICgpID0+IHsKICAgICAgICBmdW5jdGlvbiogY29tcGxl
eEdlbmVyYXRvcigpIHsKICAgICAgICAgICAgY29uc3QgYSA9IHlpZWxkICdmaXJzdCc7CiAgICAg
ICAgICAgIGNvbnN0IGIgPSB5aWVsZCBhICsgJyBzZWNvbmQnOwogICAgICAgICAgICBjb25zdCBj
ID0geWllbGQgYiArICcgdGhpcmQnOwogICAgICAgICAgICByZXR1cm4gYyArICcgZG9uZSc7CiAg
ICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnN0IGdlbiA9IGNvbXBsZXhHZW5lcmF0b3IoKTsK
ICAgICAgICAKICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBlY3QoZ2VuLm5leHQoKS52YWx1ZSku
dG9CZSgnZmlyc3QnKTsKICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBlY3QoZ2VuLm5leHQoJ2lu
cHV0MScpLnZhbHVlKS50b0JlKCdpbnB1dDEgc2Vjb25kJyk7CiAgICAgICAgYWR2YW5jZWRUZXN0
ZXIuZXhwZWN0KGdlbi5uZXh0KCdpbnB1dDInKS52YWx1ZSkudG9CZSgnaW5wdXQyIHRoaXJkJyk7
CiAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0KGdlbi5uZXh0KCdpbnB1dDMnKSkudG9FcXVh
bCh7IHZhbHVlOiAnaW5wdXQzIGRvbmUnLCBkb25lOiB0cnVlIH0pOwogICAgICAgIGFkdmFuY2Vk
VGVzdGVyLmV4cGVjdChnZW4ubmV4dCgpKS50b0VxdWFsKHsgZG9uZTogdHJ1ZSB9KTsKICAgICAg
ICAKICAgICAgICAvLyBHZW5lcmF0b3Igd2l0aCB0aHJvdwogICAgICAgIGZ1bmN0aW9uKiBnZW5l
cmF0b3JXaXRoRXJyb3IoKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB5aWVs
ZCAnc3RhcnQnOwogICAgICAgICAgICAgICAgeWllbGQgJ3VucmVhY2hhYmxlJzsKICAgICAgICAg
ICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIHlpZWxkIGBjYXVnaHQ6ICR7ZXJy
b3IubWVzc2FnZX1gOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNv
bnN0IGVycm9yR2VuID0gZ2VuZXJhdG9yV2l0aEVycm9yKCk7CiAgICAgICAgZXJyb3JHZW4ubmV4
dCgpOwogICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVjdChlcnJvckdlbi50aHJvdyhuZXcgRXJy
b3IoJ3Rlc3QnKSkudmFsdWUpLnRvQmUoJ2NhdWdodDogdGVzdCcpOwogICAgfSk7CgogICAgYWR2
YW5jZWRUZXN0ZXIudGVzdCgnSXRlcmF0b3IgSGVscGVycycsICgpID0+IHsKICAgICAgICAvLyBD
dXN0b20gaXRlcmF0b3IgbWV0aG9kcwogICAgICAgIE51bWJlci5wcm90b3R5cGVbU3ltYm9sLml0
ZXJhdG9yXSA9IGZ1bmN0aW9uKigpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0
aGlzOyBpKyspIHlpZWxkIGk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICBjb25zdCBudW1i
ZXJzID0gWy4uLjVdOwogICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVjdChudW1iZXJzKS50b0Vx
dWFsKFswLCAxLCAyLCAzLCA0XSk7CiAgICAgICAgCiAgICAgICAgLy8gSXRlcmF0b3IgdXRpbGl0
aWVzCiAgICAgICAgZnVuY3Rpb24gdGFrZShpdGVyYXRvciwgbikgewogICAgICAgICAgICByZXR1
cm4gewogICAgICAgICAgICAgICAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7CiAgICAgICAgICAgICAg
ICAgICAgY29uc3QgaXQgPSBpdGVyYXRvcltTeW1ib2wuaXRlcmF0b3JdKCk7CiAgICAgICAgICAg
ICAgICAgICAgbGV0IGNvdW50ID0gbjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAg
ICAgICAgICAgICAgICAgICAgICBuZXh0KCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg
aWYgKGNvdW50LS0gPiAwKSByZXR1cm4gaXQubmV4dCgpOwogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAg
ICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAg
ICAgICB9CiAgICAgICAgCiAgICAgICAgY29uc3QgdGFrZW4gPSBbLi4udGFrZShbMSwgMiwgMywg
NCwgNV1bU3ltYm9sLml0ZXJhdG9yXSgpLCAzKV07CiAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhw
ZWN0KHRha2VuKS50b0VxdWFsKFsxLCAyLCAzXSk7CiAgICB9KTsKfSk7CgovLyA9PT09PT09PT09
IEFEVkFOQ0VEIFBST01JU0UgUEFUVEVSTlMgPT09PT09PT09PQphZHZhbmNlZFRlc3Rlci5kZXNj
cmliZSgnQWR2YW5jZWQgUHJvbWlzZXMnLCAoKSA9PiB7CiAgICBhZHZhbmNlZFRlc3Rlci50ZXN0
KCdQcm9taXNlIENvbWJpbmF0b3JzJywgYXN5bmMgKCkgPT4gewogICAgICAgIGNvbnN0IGZhc3Qg
PSBQcm9taXNlLnJlc29sdmUoJ2Zhc3QnKTsKICAgICAgICBjb25zdCBzbG93ID0gbmV3IFByb21p
c2UociA9PiBzZXRUaW1lb3V0KCgpID0+IHIoJ3Nsb3cnKSwgMTAwKSk7CiAgICAgICAgCiAgICAg
ICAgLy8gUHJvbWlzZS5hbGwKICAgICAgICBjb25zdCBhbGxSZXN1bHRzID0gYXdhaXQgUHJvbWlz
ZS5hbGwoW2Zhc3QsIHNsb3ddKTsKICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBlY3QoYWxsUmVz
dWx0cykudG9FcXVhbChbJ2Zhc3QnLCAnc2xvdyddKTsKICAgICAgICAKICAgICAgICAvLyBQcm9t
aXNlLnJhY2UKICAgICAgICBjb25zdCByYWNlUmVzdWx0ID0gYXdhaXQgUHJvbWlzZS5yYWNlKFtm
YXN0LCBzbG93XSk7CiAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0KHJhY2VSZXN1bHQpLnRv
QmUoJ2Zhc3QnKTsKICAgICAgICAKICAgICAgICAvLyBQcm9taXNlLmFsbFNldHRsZWQgd2l0aCBl
cnJvcgogICAgICAgIGNvbnN0IGVycm9yID0gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCdmYWls
ZWQnKSk7CiAgICAgICAgY29uc3Qgc2V0dGxlZCA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChb
ZmFzdCwgZXJyb3JdKTsKICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBlY3Qoc2V0dGxlZCkudG9F
cXVhbChbCiAgICAgICAgICAgIHsgc3RhdHVzOiAnZnVsZmlsbGVkJywgdmFsdWU6ICdmYXN0JyB9
LAogICAgICAgICAgICB7IHN0YXR1czogJ3JlamVjdGVkJywgcmVhc29uOiBuZXcgRXJyb3IoJ2Zh
aWxlZCcpIH0KICAgICAgICBdKTsKICAgICAgICAKICAgICAgICAvLyBQcm9taXNlLmFueSAobmVl
ZHMgYXQgbGVhc3Qgb25lIHRvIHN1Y2NlZWQpCiAgICAgICAgY29uc3QgYW55UmVzdWx0ID0gYXdh
aXQgUHJvbWlzZS5hbnkoW2Zhc3QsIGVycm9yXSk7CiAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhw
ZWN0KGFueVJlc3VsdCkudG9CZSgnZmFzdCcpOwogICAgfSk7CgogICAgYWR2YW5jZWRUZXN0ZXIu
dGVzdCgnUHJvbWlzZSBQYXR0ZXJucycsIGFzeW5jICgpID0+IHsKICAgICAgICAvLyBQcm9taXNl
IGNoYWluIHdpdGggZXJyb3IgaGFuZGxpbmcKICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQ
cm9taXNlLnJlc29sdmUoMTApCiAgICAgICAgICAgIC50aGVuKHggPT4geCAqIDIpCiAgICAgICAg
ICAgIC50aGVuKHggPT4geyB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCBhdCAke3h9YCk7IH0pCiAg
ICAgICAgICAgIC5jYXRjaChlcnJvciA9PiBlcnJvci5tZXNzYWdlKQogICAgICAgICAgICAudGhl
bihtc2cgPT4gYFJlY292ZXJlZDogJHttc2d9YCk7CiAgICAgICAgCiAgICAgICAgYWR2YW5jZWRU
ZXN0ZXIuZXhwZWN0KHJlc3VsdCkudG9CZSgnUmVjb3ZlcmVkOiBGYWlsZWQgYXQgMjAnKTsKICAg
ICAgICAKICAgICAgICAvLyBQcm9taXNlIGNvbnN0cnVjdG9yIHBhdHRlcm4KICAgICAgICBjb25z
dCBkZWxheWVkVmFsdWUgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAg
ICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgTWF0aC5yYW5kb20oKSA+
IDAuNSA/IHJlc29sdmUoJ3N1Y2Nlc3MnKSA6IHJlamVjdCgnZmFpbHVyZScpOwogICAgICAgICAg
ICB9LCAxMCk7CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgY29uc3Qgd2l0aEZhbGxiYWNr
ID0gZGVsYXllZFZhbHVlLmNhdGNoKCgpID0+ICdmYWxsYmFjaycpOwogICAgICAgIGFkdmFuY2Vk
VGVzdGVyLmV4cGVjdChhd2FpdCB3aXRoRmFsbGJhY2spLnRvQmVUcnV0aHkoKTsKICAgICAgICAK
ICAgICAgICAvLyBBYm9ydGFibGUgcHJvbWlzZQogICAgICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBu
ZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICAgICAgY29uc3QgYWJvcnRhYmxlID0gbmV3IFByb21p
c2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICBjb25zdCB0aW1lb3V0ID0gc2V0
VGltZW91dCgoKSA9PiByZXNvbHZlKCdkb25lJyksIDEwMCk7CiAgICAgICAgICAgIGNvbnRyb2xs
ZXIuc2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgKCkgPT4gewogICAgICAgICAgICAg
ICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOwogICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBET01F
eGNlcHRpb24oJ0Fib3J0ZWQnLCAnQWJvcnRFcnJvcicpKTsKICAgICAgICAgICAgfSk7CiAgICAg
ICAgfSk7CiAgICAgICAgCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBjb250cm9sbGVyLmFib3J0
KCksIDUwKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhd2FpdCBhYm9ydGFibGU7CiAgICAg
ICAgICAgIHRocm93IG5ldyBFcnJvcignU2hvdWxkIGhhdmUgYWJvcnRlZCcpOwogICAgICAgIH0g
Y2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVjdChlcnJvci5u
YW1lKS50b0JlKCdBYm9ydEVycm9yJyk7CiAgICAgICAgfQogICAgfSk7CgogICAgYWR2YW5jZWRU
ZXN0ZXIudGVzdCgnQXN5bmMgUGF0dGVybnMnLCBhc3luYyAoKSA9PiB7CiAgICAgICAgLy8gU2Vx
dWVudGlhbCB2cyBwYXJhbGxlbCBleGVjdXRpb24KICAgICAgICBjb25zdCBzZXF1ZW50aWFsID0g
YXN5bmMgKCkgPT4gewogICAgICAgICAgICBjb25zdCBhID0gYXdhaXQgUHJvbWlzZS5yZXNvbHZl
KCdBJyk7CiAgICAgICAgICAgIGNvbnN0IGIgPSBhd2FpdCBQcm9taXNlLnJlc29sdmUoJ0InKTsK
ICAgICAgICAgICAgcmV0dXJuIFthLCBiXTsKICAgICAgICB9OwogICAgICAgIAogICAgICAgIGNv
bnN0IHBhcmFsbGVsID0gYXN5bmMgKCkgPT4gewogICAgICAgICAgICBjb25zdCBbYSwgYl0gPSBh
d2FpdCBQcm9taXNlLmFsbChbCiAgICAgICAgICAgICAgICBQcm9taXNlLnJlc29sdmUoJ0EnKSwK
ICAgICAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZSgnQicpCiAgICAgICAgICAgIF0pOwogICAg
ICAgICAgICByZXR1cm4gW2EsIGJdOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgYWR2YW5j
ZWRUZXN0ZXIuZXhwZWN0KGF3YWl0IHNlcXVlbnRpYWwoKSkudG9FcXVhbChbJ0EnLCAnQiddKTsK
ICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBlY3QoYXdhaXQgcGFyYWxsZWwoKSkudG9FcXVhbChb
J0EnLCAnQiddKTsKICAgICAgICAKICAgICAgICAvLyBBc3luYyBnZW5lcmF0b3IgY29uc3VtcHRp
b24KICAgICAgICBhc3luYyBmdW5jdGlvbiogYXN5bmNOdW1iZXJzKCkgewogICAgICAgICAgICB5
aWVsZCBhd2FpdCBQcm9taXNlLnJlc29sdmUoMSk7CiAgICAgICAgICAgIHlpZWxkIGF3YWl0IFBy
b21pc2UucmVzb2x2ZSgyKTsKICAgICAgICAgICAgeWllbGQgYXdhaXQgUHJvbWlzZS5yZXNvbHZl
KDMpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb25zdCBjb2xsZWN0ZWQgPSBbXTsKICAg
ICAgICBmb3IgYXdhaXQgKGNvbnN0IG51bSBvZiBhc3luY051bWJlcnMoKSkgewogICAgICAgICAg
ICBjb2xsZWN0ZWQucHVzaChudW0pOwogICAgICAgIH0KICAgICAgICBhZHZhbmNlZFRlc3Rlci5l
eHBlY3QoY29sbGVjdGVkKS50b0VxdWFsKFsxLCAyLCAzXSk7CiAgICB9KTsKfSk7CgovLyA9PT09
PT09PT09IEFEVkFOQ0VEIFJFR0VYIEFORCBTVFJJTkdTID09PT09PT09PT0KYWR2YW5jZWRUZXN0
ZXIuZGVzY3JpYmUoJ0FkdmFuY2VkIFJlZ2V4ICYgU3RyaW5ncycsICgpID0+IHsKICAgIGFkdmFu
Y2VkVGVzdGVyLnRlc3QoJ1JlZ0V4cCBGZWF0dXJlcycsICgpID0+IHsKICAgICAgICAvLyBVbmlj
b2RlIHByb3BlcnR5IGVzY2FwZXMgKG1pZ2h0IG5vdCB3b3JrIGluIG9sZGVyIE5vZGUpCiAgICAg
ICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgZW1vamlSZWdleCA9IC9ccHtFbW9qaX0vdTsKICAg
ICAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0KGVtb2ppUmVnZXgudGVzdCgn8J+YgCcpKS50
b0JlKHRydWUpOwogICAgICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBlY3QoZW1vamlSZWdleC50
ZXN0KCdhJykpLnRvQmUoZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAg
ICAgIGNvbnNvbGUubG9nKCcgICAgIE5vdGU6IFVuaWNvZGUgcHJvcGVydHkgZXNjYXBlcyBub3Qg
c3VwcG9ydGVkJyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIExvb2thaGVhZCBhbmQg
bG9va2JlaGluZAogICAgICAgIGNvbnN0IHBhc3N3b3JkUmVnZXggPSAvXig/PS4qW0EtWl0pKD89
LipcZCkoPz0uKltAJCElKj8mXSlbQS1aYS16XGRAJCElKj8mXXs4LH0kLzsKICAgICAgICBhZHZh
bmNlZFRlc3Rlci5leHBlY3QocGFzc3dvcmRSZWdleC50ZXN0KCdQYXNzd29yZDEhJykpLnRvQmUo
dHJ1ZSk7CiAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0KHBhc3N3b3JkUmVnZXgudGVzdCgn
cGFzc3dvcmQnKSkudG9CZShmYWxzZSk7CiAgICAgICAgCiAgICAgICAgLy8gTmFtZWQgY2FwdHVy
ZSBncm91cHMKICAgICAgICBjb25zdCBkYXRlUmVnZXggPSAvKD88eWVhcj5cZHs0fSktKD88bW9u
dGg+XGR7Mn0pLSg/PGRheT5cZHsyfSkvOwogICAgICAgIGNvbnN0IG1hdGNoID0gJzIwMjQtMTIt
MjUnLm1hdGNoKGRhdGVSZWdleCk7CiAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0KG1hdGNo
Lmdyb3VwcykudG9FcXVhbCh7IHllYXI6ICcyMDI0JywgbW9udGg6ICcxMicsIGRheTogJzI1JyB9
KTsKICAgICAgICAKICAgICAgICAvLyBEb3RhbGwgZmxhZyAocykgLSBtaWdodCBub3Qgd29yayBp
biBvbGRlciBOb2RlCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgbXVsdGlsaW5lUmVn
ZXggPSAvaGVsbG8ud29ybGQvczsKICAgICAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0KG11
bHRpbGluZVJlZ2V4LnRlc3QoJ2hlbGxvXG53b3JsZCcpKS50b0JlKHRydWUpOwogICAgICAgIH0g
Y2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCcgICAgIE5vdGU6IERvdGFs
bCBmbGFnIG5vdCBzdXBwb3J0ZWQnKTsKICAgICAgICB9CiAgICB9KTsKCiAgICBhZHZhbmNlZFRl
c3Rlci50ZXN0KCdTdHJpbmcgTWV0aG9kcycsICgpID0+IHsKICAgICAgICAvLyBUZW1wbGF0ZSBs
aXRlcmFscyBhZHZhbmNlZAogICAgICAgIGNvbnN0IHRhZ2dlZFRlbXBsYXRlID0gKHN0cmluZ3Ms
IC4uLnZhbHVlcykgPT4gewogICAgICAgICAgICByZXR1cm4gc3RyaW5ncy5yZWR1Y2UoKHJlc3Vs
dCwgc3RyLCBpKSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0ICsgc3RyICsgKHZh
bHVlc1tpXSA/IGBbJHt2YWx1ZXNbaV19XWAgOiAnJyk7CiAgICAgICAgICAgIH0sICcnKTsKICAg
ICAgICB9OwogICAgICAgIAogICAgICAgIGNvbnN0IHJlc3VsdCA9IHRhZ2dlZFRlbXBsYXRlYEhl
bGxvICR7J1dvcmxkJ30gZnJvbSAkeydKYXZhU2NyaXB0J31gOwogICAgICAgIGFkdmFuY2VkVGVz
dGVyLmV4cGVjdChyZXN1bHQpLnRvQmUoJ0hlbGxvIFtXb3JsZF0gZnJvbSBbSmF2YVNjcmlwdF0n
KTsKICAgICAgICAKICAgICAgICAvLyBTdHJpbmcucmF3CiAgICAgICAgY29uc3QgcGF0aCA9IFN0
cmluZy5yYXdgQzpcVXNlcnNcTmFtZVxEb2N1bWVudHNcZmlsZS50eHRgOwogICAgICAgIGFkdmFu
Y2VkVGVzdGVyLmV4cGVjdChwYXRoKS50b0JlKCdDOlxcVXNlcnNcXE5hbWVcXERvY3VtZW50c1xc
ZmlsZS50eHQnKTsKICAgICAgICAKICAgICAgICAvLyBwYWRTdGFydC9wYWRFbmQgd2l0aCBkaWZm
ZXJlbnQgY2hhcmFjdGVycwogICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVjdCgnNDInLnBhZFN0
YXJ0KDUsICcwJykpLnRvQmUoJzAwMDQyJyk7CiAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0
KCd0ZXN0Jy5wYWRFbmQoMTAsICctJykpLnRvQmUoJ3Rlc3QtLS0tLS0nKTsKICAgICAgICAKICAg
ICAgICAvLyBsb2NhbGVDb21wYXJlIHdpdGggc2ltcGxlIGNvbXBhcmlzb24KICAgICAgICBjb25z
dCB3b3JkcyA9IFsneicsICdhJywgJ2MnLCAnYiddOwogICAgICAgIGNvbnN0IHNvcnRlZCA9IHdv
cmRzLnNvcnQoKGEsIGIpID0+IGEubG9jYWxlQ29tcGFyZShiKSk7CiAgICAgICAgYWR2YW5jZWRU
ZXN0ZXIuZXhwZWN0KHNvcnRlZCkudG9FcXVhbChbJ2EnLCAnYicsICdjJywgJ3onXSk7CiAgICB9
KTsKfSk7CgovLyA9PT09PT09PT09IEFEVkFOQ0VEIEVSUk9SIEhBTkRMSU5HID09PT09PT09PT0K
YWR2YW5jZWRUZXN0ZXIuZGVzY3JpYmUoJ0FkdmFuY2VkIEVycm9yIEhhbmRsaW5nJywgKCkgPT4g
ewogICAgYWR2YW5jZWRUZXN0ZXIudGVzdCgnQ3VzdG9tIEVycm9yIENsYXNzZXMnLCAoKSA9PiB7
CiAgICAgICAgY2xhc3MgVmFsaWRhdGlvbkVycm9yIGV4dGVuZHMgRXJyb3IgewogICAgICAgICAg
ICBjb25zdHJ1Y3RvcihmaWVsZCwgbWVzc2FnZSkgewogICAgICAgICAgICAgICAgc3VwZXIoYFZh
bGlkYXRpb24gZmFpbGVkIGZvciAke2ZpZWxkfTogJHttZXNzYWdlfWApOwogICAgICAgICAgICAg
ICAgdGhpcy5uYW1lID0gJ1ZhbGlkYXRpb25FcnJvcic7CiAgICAgICAgICAgICAgICB0aGlzLmZp
ZWxkID0gZmllbGQ7CiAgICAgICAgICAgICAgICB0aGlzLnRpbWVzdGFtcCA9IG5ldyBEYXRlKCk7
CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY2xhc3MgRGF0YWJhc2VF
cnJvciBleHRlbmRzIEVycm9yIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob3BlcmF0aW9uLCBj
b2RlKSB7CiAgICAgICAgICAgICAgICBzdXBlcihgRGF0YWJhc2UgJHtvcGVyYXRpb259IGZhaWxl
ZCB3aXRoIGNvZGUgJHtjb2RlfWApOwogICAgICAgICAgICAgICAgdGhpcy5uYW1lID0gJ0RhdGFi
YXNlRXJyb3InOwogICAgICAgICAgICAgICAgdGhpcy5jb2RlID0gY29kZTsKICAgICAgICAgICAg
fQogICAgICAgIH0KICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICB0aHJvdyBuZXcg
VmFsaWRhdGlvbkVycm9yKCdlbWFpbCcsICdJbnZhbGlkIGZvcm1hdCcpOwogICAgICAgIH0gY2F0
Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVjdChlcnJvci5uYW1l
KS50b0JlKCdWYWxpZGF0aW9uRXJyb3InKTsKICAgICAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhw
ZWN0KGVycm9yLmZpZWxkKS50b0JlKCdlbWFpbCcpOwogICAgICAgICAgICBhZHZhbmNlZFRlc3Rl
ci5leHBlY3QoZXJyb3IgaW5zdGFuY2VvZiBWYWxpZGF0aW9uRXJyb3IpLnRvQmUodHJ1ZSk7CiAg
ICAgICAgICAgIGFkdmFuY2VkVGVzdGVyLmV4cGVjdChlcnJvciBpbnN0YW5jZW9mIEVycm9yKS50
b0JlKHRydWUpOwogICAgICAgIH0KICAgIH0pOwoKICAgIGFkdmFuY2VkVGVzdGVyLnRlc3QoJ0Vy
cm9yIEJvdW5kYXJpZXMnLCAoKSA9PiB7CiAgICAgICAgY29uc3Qgd2l0aEVycm9yQm91bmRhcnkg
PSAoZm4sIGZhbGxiYWNrKSA9PiB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBy
ZXR1cm4gZm4oKTsKICAgICAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAgICAgICByZXR1cm4g
ZmFsbGJhY2s7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIAogICAgICAgIGNvbnN0
IHJlc3VsdCA9IHdpdGhFcnJvckJvdW5kYXJ5KAogICAgICAgICAgICAoKSA9PiB7IHRocm93IG5l
dyBFcnJvcignRmFpbCcpOyB9LAogICAgICAgICAgICAnZmFsbGJhY2sgdmFsdWUnCiAgICAgICAg
KTsKICAgICAgICBhZHZhbmNlZFRlc3Rlci5leHBlY3QocmVzdWx0KS50b0JlKCdmYWxsYmFjayB2
YWx1ZScpOwogICAgICAgIAogICAgICAgIC8vIEFzeW5jIGVycm9yIGJvdW5kYXJ5CiAgICAgICAg
Y29uc3QgYXN5bmNXaXRoQm91bmRhcnkgPSBhc3luYyAocHJvbWlzZSwgZmFsbGJhY2spID0+IHsK
ICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBwcm9taXNlOwog
ICAgICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxsYmFjazsKICAg
ICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgY29uc3QgYXN5bmNQcm9taXNl
ID0gYXN5bmNXaXRoQm91bmRhcnkoCiAgICAgICAgICAgIFByb21pc2UucmVqZWN0KG5ldyBFcnJv
cignQXN5bmMgZmFpbCcpKSwKICAgICAgICAgICAgJ2FzeW5jIGZhbGxiYWNrJwogICAgICAgICk7
CiAgICAgICAgCiAgICAgICAgLy8gSGFuZGxlIHRoZSBwcm9taXNlIHByb3Blcmx5CiAgICAgICAg
cmV0dXJuIGFzeW5jUHJvbWlzZS50aGVuKHJlc3VsdCA9PiB7CiAgICAgICAgICAgIGFkdmFuY2Vk
VGVzdGVyLmV4cGVjdChyZXN1bHQpLnRvQmUoJ2FzeW5jIGZhbGxiYWNrJyk7CiAgICAgICAgfSk7
CiAgICB9KTsKCiAgICBhZHZhbmNlZFRlc3Rlci50ZXN0KCdFcnJvciBDaGFpbmluZyBhbmQgUmVj
b3ZlcnknLCAoKSA9PiB7CiAgICAgICAgY2xhc3MgT3BlcmF0aW9uUGlwZWxpbmUgewogICAgICAg
ICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgICAgIHRoaXMuc3RlcHMgPSBbXTsKICAg
ICAgICAgICAgICAgIHRoaXMuZXJyb3JzID0gW107CiAgICAgICAgICAgIH0KICAgICAgICAgICAg
CiAgICAgICAgICAgIGFkZFN0ZXAoc3RlcCkgewogICAgICAgICAgICAgICAgdGhpcy5zdGVwcy5w
dXNoKHsgZm46IHN0ZXAsIG5hbWU6IHN0ZXAubmFtZSB8fCAnYW5vbnltb3VzJyB9KTsKICAgICAg
ICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAg
ICAgICBhc3luYyBleGVjdXRlKGlucHV0KSB7CiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0g
aW5wdXQ7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgc3RlcCBv
ZiB0aGlzLnN0ZXBzKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg
ICAgICAgICAgcmVzdWx0ID0gYXdhaXQgc3RlcC5mbihyZXN1bHQpOwogICAgICAgICAgICAgICAg
ICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3Jz
LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RlcDogc3RlcC5uYW1lLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBpbnB1dDogcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgIH0p
OwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVHJ5
IHJlY292ZXJ5IHN0cmF0ZWd5CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0
IHRoaXMucmVjb3ZlcihlcnJvciwgcmVzdWx0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiB7IHJl
c3VsdCwgZXJyb3JzOiB0aGlzLmVycm9ycyB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIAog
ICAgICAgICAgICBhc3luYyByZWNvdmVyKGVycm9yLCBpbnB1dCkgewogICAgICAgICAgICAgICAg
Ly8gRGVmYXVsdCByZWNvdmVyeTogcmV0dXJuIGlucHV0IHVuY2hhbmdlZAogICAgICAgICAgICAg
ICAgcmV0dXJuIGlucHV0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAg
IGNvbnN0IHBpcGVsaW5lID0gbmV3IE9wZXJhdGlvblBpcGVsaW5lKCk7CiAgICAgICAgY29uc3Qg
c3RlcDEgPSBhc3luYyB4ID0+IHggKiAyOwogICAgICAgIGNvbnN0IHN0ZXAyID0gYXN5bmMgeCA9
PiB7IHRocm93IG5ldyBFcnJvcignU3RlcCBmYWlsZWQnKTsgfTsKICAgICAgICBjb25zdCBzdGVw
MyA9IGFzeW5jIHggPT4geCArIDE7CiAgICAgICAgCiAgICAgICAgc3RlcDEubmFtZSA9ICdzdGVw
MSc7CiAgICAgICAgc3RlcDIubmFtZSA9ICdzdGVwMic7CiAgICAgICAgc3RlcDMubmFtZSA9ICdz
dGVwMyc7CiAgICAgICAgCiAgICAgICAgcGlwZWxpbmUuYWRkU3RlcChzdGVwMSkKICAgICAgICAg
ICAgICAgLmFkZFN0ZXAoc3RlcDIpCiAgICAgICAgICAgICAgIC5hZGRTdGVwKHN0ZXAzKTsKICAg
ICAgICAKICAgICAgICByZXR1cm4gcGlwZWxpbmUuZXhlY3V0ZSg1KS50aGVuKCh7IHJlc3VsdCwg
ZXJyb3JzIH0pID0+IHsKICAgICAgICAgICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0KHJlc3VsdCku
dG9CZSgxMCk7IC8vIFJlY292ZXJ5IHJldHVybmVkIGlucHV0IHVuY2hhbmdlZAogICAgICAgICAg
ICBhZHZhbmNlZFRlc3Rlci5leHBlY3QoZXJyb3JzLmxlbmd0aCkudG9CZSgxKTsKICAgICAgICAg
ICAgYWR2YW5jZWRUZXN0ZXIuZXhwZWN0KGVycm9yc1swXS5lcnJvcikudG9CZSgnU3RlcCBmYWls
ZWQnKTsKICAgICAgICB9KTsKICAgIH0pOwp9KTsKCi8vID09PT09PT09PT0gUlVOIEFMTCBBRFZB
TkNFRCBURVNUUyA9PT09PT09PT09CmFkdmFuY2VkVGVzdGVyLnJ1bigpLmNhdGNoKGVycm9yID0+
IHsKICAgIGNvbnNvbGUuZXJyb3IoJ1Rlc3QgcnVubmVyIGVycm9yOicsIGVycm9yKTsKfSk7Cg==
